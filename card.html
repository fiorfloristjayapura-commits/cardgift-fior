<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIOR Card Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 16px;
        }
        .card {
            background: white;
            border-radius: 24px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 24px;
        }
        .emoji { font-size: 48px; }
        .greeting { font-size: 24px; font-weight: bold; color: #1e3a5f; }
        .recipient { font-size: 20px; font-weight: 600; color: #1e3a5f; margin: 8px 0; }
        
        .expiry-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            margin: 16px 0;
        }
        .expiry-badge.permanent { background: #ede9fe; color: #7c3aed; }
        .expiry-badge.warning { background: #ffedd5; color: #b45309; }
        .expiry-badge.danger { background: #fee2e2; color: #b91c1c; }
        .expiry-badge.success { background: #d1fae5; color: #0f766e; }
        
        .message {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 16px;
            margin: 16px 0;
        }
        
        .media-list {
            margin: 16px 0;
            padding: 16px;
            background: #f0f0f0;
            border-radius: 8px;
        }
        
        .media-item {
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .debug {
            background: #1e1e1e;
            color: #00ff00;
            padding: 16px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 24px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <div class="card">
        <div class="header">
            <div class="emoji" id="themeEmoji">üéÇ</div>
            <div class="greeting" id="greetingText">Happy Birthday</div>
            <div class="recipient" id="recipientName">[Nama]</div>
        </div>
        
        <div style="text-align: center;">
            <div class="expiry-badge" id="expiryBadge">
                <span id="expiryBadgeText">Memuat...</span>
            </div>
        </div>
        
        <div class="message" id="messageText">
            Memuat pesan...
        </div>
        
        <div class="media-list" id="mediaList">
            <strong>Media:</strong> Tidak ada
        </div>
        
        <div class="debug" id="debugInfo"></div>
    </div>

    <script>
        const CONFIG = {
            SCRIPT_URL: "https://script.google.com/macros/s/AKfycbz2LJYVbyVkfsq3SKpczvnckcmir55jDijhUL6Bbm1GDfjEbBQgZ6DYb_6MI8kMsw6wCA/exec"
        };

        async function init() {
            const params = new URLSearchParams(window.location.search);
            const messageId = params.get('v');
            const to = params.get('to') || 'Sahabat';
            const theme = params.get('theme') || 'birthday';
            
            // Tampilkan recipient
            document.getElementById('recipientName').textContent = to;
            
            // Kumpulkan semua media dari URL
            const mediaList = [];
            if (params.get('media')) mediaList.push(params.get('media'));
            let i = 1;
            while (params.get(`media${i}`)) {
                mediaList.push(params.get(`media${i}`));
                i++;
            }
            
            // Tampilkan media
            let mediaHTML = '<strong>Media Ditemukan (' + mediaList.length + '):</strong><br>';
            if (mediaList.length > 0) {
                mediaList.forEach((url, idx) => {
                    mediaHTML += `<div class="media-item">${idx + 1}. <a href="${url}" target="_blank">${url.substring(0, 50)}...</a></div>`;
                });
            } else {
                mediaHTML += '<div>Tidak ada media</div>';
            }
            document.getElementById('mediaList').innerHTML = mediaHTML;
            
            // Debug info
            let debug = 'üîç URL PARAMETERS:\n';
            debug += `v: ${messageId || 'TIDAK ADA'}\n`;
            debug += `to: ${to}\n`;
            debug += `theme: ${theme}\n`;
            debug += `media: ${mediaList.length} items\n`;
            debug += '----------------------------------------\n';
            
            if (messageId) {
                debug += `\nüì° Fetching message ID: ${messageId}\n`;
                
                try {
                    const url = `${CONFIG.SCRIPT_URL}?type=get_message&id=${messageId}&t=${Date.now()}`;
                    debug += `URL: ${url}\n`;
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    debug += `\nüì• RESPONSE:\n${JSON.stringify(data, null, 2)}\n`;
                    
                    if (data.status === 'success') {
                        document.getElementById('messageText').textContent = data.message;
                        
                        const badge = document.getElementById('expiryBadge');
                        const badgeText = document.getElementById('expiryBadgeText');
                        
                        if (data.expiry_setting === 'never') {
                            badge.className = 'expiry-badge permanent';
                            badgeText.innerHTML = '‚ôæÔ∏è Permanen';
                        } else if (data.is_expired) {
                            badge.className = 'expiry-badge danger';
                            badgeText.innerHTML = '‚ö†Ô∏è Expired';
                        } else {
                            badge.className = 'expiry-badge success';
                            badgeText.innerHTML = `‚è≥ ${data.days_remaining} hari lagi`;
                        }
                    } else {
                        document.getElementById('messageText').textContent = '‚ùå ' + data.message;
                        document.getElementById('expiryBadge').className = 'expiry-badge danger';
                        document.getElementById('expiryBadgeText').innerHTML = '‚ùå Tidak ditemukan';
                    }
                    
                } catch (error) {
                    debug += `\n‚ùå ERROR: ${error.message}\n`;
                    document.getElementById('messageText').textContent = 'Error: ' + error.message;
                }
            } else {
                document.getElementById('messageText').textContent = 'Tidak ada parameter v';
                document.getElementById('expiryBadge').className = 'expiry-badge danger';
                document.getElementById('expiryBadgeText').innerHTML = '‚ùå No ID';
            }
            
            document.getElementById('debugInfo').textContent = debug;
        }

        init();
    </script>
</body>
</html>
