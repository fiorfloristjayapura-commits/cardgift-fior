<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIOR Card - Digital Greeting</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;800&family=Plus+Jakarta+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        body{
            font-family:'Plus Jakarta Sans',sans-serif;
            background:#fff9f0;
            display:flex;
            justify-content:center;
            align-items:center;
            min-height:100vh;
            padding:20px;
        }
        .card{
            width:420px;
            background:white;
            border-radius:28px;
            overflow:hidden;
            box-shadow:0 20px 40px rgba(0,0,0,0.15);
        }
        .header{
            background:linear-gradient(145deg,#1e3a5f,#2b4c73);
            color:white;
            text-align:center;
            padding:40px 20px;
        }
        .emoji{
            font-size:60px;
            margin-bottom:10px;
        }
        .greeting{
            font-family:'Playfair Display',serif;
            font-size:28px;
            font-weight:800;
        }
        .recipient{
            font-family:'Playfair Display',serif;
            font-size:24px;
            margin-top:10px;
        }
        .body{
            padding:24px;
        }
        .badge{
            display:inline-block;
            padding:6px 14px;
            border-radius:30px;
            font-size:12px;
            margin-bottom:14px;
        }
        .success{background:#d1fae5;color:#065f46;}
        .warning{background:#ffedd5;color:#9a3412;}
        .danger{background:#fee2e2;color:#991b1b;}
        .permanent{background:#ede9fe;color:#6d28d9;}
        .message{
            background:#fff9f0;
            padding:18px;
            border-radius:18px;
            text-align:center;
            font-style:italic;
            line-height:1.6;
        }
        .footer{
            text-align:center;
            padding:20px;
            border-top:1px solid #eee;
            font-weight:600;
        }
    </style>
</head>

<body>

<div class="card">
    <div class="header">
        <div class="emoji" id="emoji">üéÇ</div>
        <div class="greeting" id="greeting">Loading...</div>
        <div class="recipient" id="recipient">...</div>
    </div>

    <div class="body">
        <div id="expiryBadge" class="badge">Memuat...</div>
        <div id="message" class="message">Memuat pesan...</div>
    </div>

    <div class="footer">
        FIOR Florist Jayapura
    </div>
</div>

<script>
const CONFIG = {
    // SCRIPT FINAL (HARUS SAMA DENGAN ADMIN)
    SCRIPT_URL: "https://script.google.com/macros/s/AKfycbzTPgv-D6VNNlh0QHERaizfzN4tWCs42Xdr3sZLdpIzs3oHQAuz5D-6tqfO5U7E2QHmEw/exec"
};

const THEMES = {
    birthday: { emoji: 'üéÇ', greeting: 'Happy Birthday' },
    wedding: { emoji: 'üíç', greeting: 'Congratulations' },
    valentine: { emoji: '‚ù§Ô∏è', greeting: 'Happy Valentine' },
    anniversary: { emoji: 'üéâ', greeting: 'Happy Anniversary' },
    graduation: { emoji: 'üéì', greeting: 'Congratulations!' },
    condolence: { emoji: 'üïäÔ∏è', greeting: 'Deepest Condolences' },
    congratulation: { emoji: 'üéä', greeting: 'Congratulations!' },
    imlek: { emoji: 'üßß', greeting: 'Gong Xi Fa Cai' },
    natal: { emoji: 'üéÑ', greeting: 'Merry Christmas' },
    lebaran: { emoji: 'üåô', greeting: 'Selamat Lebaran' }
};

function getParams(){
    const p = new URLSearchParams(location.search);
    return {
        to: p.get('to') || 'Sahabat',
        theme: p.get('theme') || 'birthday',
        id: p.get('v')
    };
}

function setExpiryBadge(data){
    const badge = document.getElementById('expiryBadge');

    if(data.expiry_setting === 'never'){
        badge.className = 'badge permanent';
        badge.innerText = 'Permanen';
        return;
    }

    if(data.is_expired){
        badge.className = 'badge danger';
        badge.innerText = 'Expired';
        return;
    }

    if(data.days_remaining <= 7){
        badge.className = 'badge warning';
        badge.innerText = data.days_remaining + ' hari lagi';
        return;
    }

    badge.className = 'badge success';
    badge.innerText = data.days_remaining + ' hari';
}

async function loadCard(){
    const params = getParams();

    const theme = THEMES[params.theme] || THEMES.birthday;

    document.getElementById('recipient').innerText = params.to;
    document.getElementById('greeting').innerText = theme.greeting;
    document.getElementById('emoji').innerText = theme.emoji;

    if(!params.id){
        document.getElementById('message').innerText = 'Pesan tidak ditemukan';
        return;
    }

    try{
        const url = `${CONFIG.SCRIPT_URL}?cmd=get&id=${params.id}`;
        const res = await fetch(url);
        const data = await res.json();

        if(data.status === 'success'){
            document.getElementById('message').innerText = data.message;
            setExpiryBadge(data);
        }else{
            document.getElementById('message').innerText =
                'Pesan tidak ditemukan atau telah kadaluarsa';
            document.getElementById('expiryBadge').className = 'badge danger';
            document.getElementById('expiryBadge').innerText = 'Expired';
        }
    }catch(err){
        document.getElementById('message').innerText = 'Gagal memuat pesan';
    }
}

loadCard();
</script>

</body>
</html>
