<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIOR Card - Digital Greeting</title>
    
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;800&family=Plus+Jakarta+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <!-- CSS TETAP PUNYA MAS (tidak diubah) -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        .theme-birthday { --primary: #1e3a5f; --accent: #d4af37; --gradient: linear-gradient(145deg, #1e3a5f, #2b4c73); --bg: #fff9f0; }
        .theme-valentine { --primary: #b76e79; --accent: #ffb6c1; --gradient: linear-gradient(145deg, #b76e79, #c98b95); --bg: #fff5f8; }
        .theme-wedding { --primary: #b2ac88; --accent: #e6d5b8; --gradient: linear-gradient(145deg, #b2ac88, #c5bf9c); --bg: #fffcf9; }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }
        .mobile-container { max-width: 450px; width: 100%; }
        .card {
            background: white;
            border-radius: 32px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .card-header {
            background: var(--gradient);
            padding: 40px 20px;
            text-align: center;
            color: white;
        }
        .theme-emoji { font-size: 64px; }
        .greeting { font-size: 2rem; font-weight: 800; }
        .recipient-name { font-size: 1.6rem; font-weight: 700; }
        .card-body { padding: 24px; }
        .expiry-badge { padding:6px 14px;border-radius:30px;font-size:12px;display:inline-block;margin-bottom:12px;}
        .success{background:#d1fae5;color:#065f46;}
        .warning{background:#ffedd5;color:#9a3412;}
        .danger{background:#fee2e2;color:#991b1b;}
        .permanent{background:#ede9fe;color:#6d28d9;}
        .message {
            background:#fff9f0;
            padding:18px;
            border-radius:18px;
            text-align:center;
            font-style:italic;
            line-height:1.6;
        }
    </style>
</head>

<body class="theme-birthday">
<div class="mobile-container">
    <div class="card">
        <div class="card-header">
            <div class="theme-emoji" id="themeEmoji">üéÇ</div>
            <div class="greeting" id="greetingText">Happy Birthday</div>
            <div class="recipient-name" id="recipientName">...</div>
        </div>

        <div class="card-body">
            <div id="expiryBadge" class="expiry-badge">Memuat...</div>
            <div class="message" id="messageText">Memuat pesan...</div>
        </div>
    </div>
</div>

<script>
const CONFIG = {
    // SCRIPT ADMIN (SUDAH DISAMAKAN)
    SCRIPT_URL: "https://script.google.com/macros/s/AKfycbzTPgv-D6VNNlh0QHERaizfzN4tWCs42Xdr3sZLdpIzs3oHQAuz5D-6tqfO5U7E2QHmEw/exec"
};

const THEMES = {
    birthday: { emoji: 'üéÇ', greeting: 'Happy Birthday' },
    wedding: { emoji: 'üíç', greeting: 'Congratulations' },
    valentine: { emoji: '‚ù§Ô∏è', greeting: 'Happy Valentine' },
    anniversary: { emoji: 'üéâ', greeting: 'Happy Anniversary' },
    graduation: { emoji: 'üéì', greeting: 'Congratulations!' },
    condolence: { emoji: 'üïäÔ∏è', greeting: 'Deepest Condolences' },
    congratulation: { emoji: 'üéä', greeting: 'Congratulations!' },
    imlek: { emoji: 'üßß', greeting: 'Gong Xi Fa Cai' },
    natal: { emoji: 'üéÑ', greeting: 'Merry Christmas' },
    lebaran: { emoji: 'üåô', greeting: 'Selamat Lebaran' }
};

function getParams(){
    const p = new URLSearchParams(location.search);
    return {
        to: p.get('to') || 'Sahabat',
        theme: p.get('theme') || 'birthday',
        id: p.get('v')
    };
}

function setExpiryBadge(data){
    const badge = document.getElementById('expiryBadge');

    if(data.expiry_setting === 'never'){
        badge.className = 'expiry-badge permanent';
        badge.innerText = 'Permanen';
        return;
    }

    if(data.is_expired){
        badge.className = 'expiry-badge danger';
        badge.innerText = 'Expired';
        return;
    }

    if(data.days_remaining <= 7){
        badge.className = 'expiry-badge warning';
        badge.innerText = data.days_remaining + ' hari lagi';
        return;
    }

    badge.className = 'expiry-badge success';
    badge.innerText = data.days_remaining + ' hari';
}

async function loadCard(){
    const params = getParams();
    const theme = THEMES[params.theme] || THEMES.birthday;

    document.body.className = `theme-${params.theme}`;
    document.getElementById('recipientName').innerText = params.to;
    document.getElementById('greetingText').innerText = theme.greeting;
    document.getElementById('themeEmoji').innerText = theme.emoji;

    if(!params.id){
        document.getElementById('messageText').innerText = 'Pesan tidak ditemukan';
        return;
    }

    try{
        const url = `${CONFIG.SCRIPT_URL}?cmd=get&id=${params.id}`;
        const res = await fetch(url);
        const data = await res.json();

        if(data.status === 'success'){
            document.getElementById('messageText').innerText = data.message;
            setExpiryBadge(data);
        }else{
            document.getElementById('messageText').innerText =
                'Pesan tidak ditemukan atau telah kadaluarsa';
            document.getElementById('expiryBadge').className = 'expiry-badge danger';
            document.getElementById('expiryBadge').innerText = 'Expired';
        }
    }catch(err){
        document.getElementById('messageText').innerText = 'Gagal memuat pesan';
    }
}

loadCard();
</script>
</body>
</html>
