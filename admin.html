<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FIOR Admin Panel</title>

<style>
:root{
    --gold:#d4af37;
    --dark:#111;
    --card:#1b1b1b;
    --text:#f1f1f1;
}

body{
    margin:0;
    font-family:Segoe UI, sans-serif;
    background:linear-gradient(135deg,#0f0f0f,#1a1a1a);
    color:var(--text);
}

.container{
    max-width:500px;
    margin:60px auto;
    padding:30px;
    background:var(--card);
    border-radius:15px;
    box-shadow:0 20px 60px rgba(0,0,0,0.6);
    border:1px solid rgba(212,175,55,0.3);
}

h1{
    text-align:center;
    color:var(--gold);
    font-weight:300;
    margin-bottom:30px;
}

input, textarea, select{
    width:100%;
    padding:14px;
    margin:10px 0;
    border-radius:10px;
    border:1px solid rgba(212,175,55,0.3);
    background:#111;
    color:white;
    font-size:15px;
}

textarea{
    min-height:120px;
}

button{
    width:100%;
    padding:14px;
    border:none;
    border-radius:10px;
    background:linear-gradient(135deg,#d4af37,#b8941f);
    color:black;
    font-size:16px;
    font-weight:bold;
    cursor:pointer;
    margin-top:15px;
}

button:hover{
    opacity:0.9;
}

#result{
    margin-top:25px;
    padding:15px;
    background:#000;
    border-radius:10px;
    font-size:14px;
    word-break:break-all;
}

.upload-box{
    border:2px dashed rgba(212,175,55,0.4);
    padding:20px;
    text-align:center;
    border-radius:12px;
    margin-top:15px;
}
</style>
</head>

<body>
<div class="container">
    <h1>FIOR Card Generator</h1>

    <input id="recipientName" placeholder="Nama penerima">

    <input id="whatsappNumber" placeholder="Nomor WhatsApp">

    <textarea id="cardMessage" placeholder="Pesan ucapan"></textarea>

    <select id="selectedTheme">
        <option value="birthday">Birthday</option>
        <option value="valentine">Valentine</option>
        <option value="wedding">Wedding</option>
        <option value="anniversary">Anniversary</option>
        <option value="graduation">Graduation</option>
        <option value="condolence">Condolence</option>
    </select>

    <div class="upload-box">
        <input type="file" id="mediaUpload">
        <small>Upload foto atau video (opsional, max 10MB)</small>
    </div>

    <button onclick="createCard()">Generate Card</button>

    <div id="result"></div>
</div>

<script>
const CONFIG = {
    SCRIPT_URL: "https://script.google.com/macros/s/AKfycbz2LJYVbyVkfsq3SKpczvnckcmir55jDijhUL6Bbm1GDfjEbBQgZ6DYb_6MI8kMsw6wCA/exec",
    CARD_BASE_URL: "card.html"
};

let uploadedMedia = null;

document.getElementById("mediaUpload").addEventListener("change", e=>{
    uploadedMedia = e.target.files[0] || null;
});

async function createCard(){
    const name = document.getElementById("recipientName").value;
    const phone = document.getElementById("whatsappNumber").value;
    const message = document.getElementById("cardMessage").value;
    const theme = document.getElementById("selectedTheme").value;

    if(!name || !phone || !message){
        alert("Lengkapi data dulu");
        return;
    }

    let mediaUrl = "";

    if(uploadedMedia){
        try{
            mediaUrl = await uploadToGoogleDrive(uploadedMedia);
        }catch(e){
            alert("Upload media gagal");
        }
    }

    let cardUrl =
        `${CONFIG.CARD_BASE_URL}?to=${encodeURIComponent(name)}`
        + `&msg=${encodeURIComponent(message)}`
        + `&theme=${theme}`;

    if(mediaUrl){
        cardUrl += `&media=${encodeURIComponent(mediaUrl)}`;
    }

    document.getElementById("result").innerHTML =
        `<a href="${cardUrl}" target="_blank">${cardUrl}</a>`;

    // simpan ke Google Sheet
    await fetch(CONFIG.SCRIPT_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            type:"card",
            nama:name,
            tema:theme,
            pesan:message,
            link:cardUrl,
            media_url:mediaUrl
        })
    });
}

async function uploadToGoogleDrive(file) {
    const base64Data = await fileToBase64(file);

    const payload = {
        type: "media",
        filename: file.name,
        mimeType: file.type,
        data: base64Data.split(',')[1]
    };

    const response = await fetch(CONFIG.SCRIPT_URL, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
    });

    const result = await response.json();

    if (result.status === "success" && result.url) {
        return result.url;
    } else {
        throw new Error(result.message || "Upload gagal");
    }
}

function fileToBase64(file){
    return new Promise((resolve,reject)=>{
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = ()=>resolve(reader.result);
        reader.onerror = reject;
    });
}
</script>
</body>
</html>
