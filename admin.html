<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FIOR Admin Panel</title>

<style>
:root{
    --gold:#d4af37;
    --dark:#111;
    --card:#1b1b1b;
    --text:#f1f1f1;
}

body{
    margin:0;
    font-family:Segoe UI, sans-serif;
    background:linear-gradient(135deg,#0f0f0f,#1a1a1a);
    color:var(--text);
}

/* Layout */
.wrapper{
    display:flex;
    min-height:100vh;
}

.sidebar{
    width:220px;
    background:#000;
    padding:20px;
    border-right:1px solid rgba(212,175,55,0.2);
}

.sidebar h2{
    color:var(--gold);
    font-weight:300;
    text-align:center;
    margin-bottom:30px;
}

.nav a{
    display:block;
    padding:12px;
    color:#ccc;
    text-decoration:none;
    border-radius:8px;
    margin-bottom:8px;
}

.nav a:hover,
.nav a.active{
    background:rgba(212,175,55,0.2);
    color:var(--gold);
}

.content{
    flex:1;
    padding:40px;
}

.card{
    background:var(--card);
    padding:25px;
    border-radius:15px;
    border:1px solid rgba(212,175,55,0.3);
    max-width:500px;
}

/* Form */
input, textarea, select{
    width:100%;
    padding:12px;
    margin:10px 0;
    border-radius:8px;
    border:1px solid rgba(212,175,55,0.3);
    background:#111;
    color:white;
}

button{
    width:100%;
    padding:14px;
    background:linear-gradient(135deg,#d4af37,#b8941f);
    border:none;
    border-radius:10px;
    font-weight:bold;
    cursor:pointer;
}

#result{
    margin-top:20px;
    background:#000;
    padding:15px;
    border-radius:10px;
    word-break:break-all;
}

.hidden{
    display:none;
}
</style>
</head>

<body>
<div class="wrapper">

    <!-- Sidebar -->
    <div class="sidebar">
        <h2>FIOR</h2>
        <div class="nav">
            <a href="#" class="active" onclick="showPage('dashboard')">Dashboard</a>
            <a href="#" onclick="showPage('create')">Create Card</a>
        </div>
    </div>

    <!-- Content -->
    <div class="content">

        <!-- Dashboard -->
        <div id="dashboardPage">
            <h1>Dashboard</h1>
            <p>Selamat datang di sistem kartu digital FIOR.</p>
        </div>

        <!-- Create Card -->
        <div id="createPage" class="hidden">
            <h1>Create Card</h1>

            <div class="card">
                <input id="recipientName" placeholder="Nama penerima">
                <input id="whatsappNumber" placeholder="Nomor WhatsApp">
                <textarea id="cardMessage" placeholder="Pesan ucapan"></textarea>

                <select id="selectedTheme">
                    <option value="birthday">Birthday</option>
                    <option value="valentine">Valentine</option>
                    <option value="wedding">Wedding</option>
                    <option value="anniversary">Anniversary</option>
                    <option value="graduation">Graduation</option>
                    <option value="condolence">Condolence</option>
                </select>

                <input type="file" id="mediaUpload">

                <button onclick="createCard()">Generate Card</button>

                <div id="result"></div>
            </div>
        </div>

    </div>
</div>

<script>
const CONFIG = {
    SCRIPT_URL: "https://script.google.com/macros/s/AKfycbz2LJYVbyVkfsq3SKpczvnckcmir55jDijhUL6Bbm1GDfjEbBQgZ6DYb_6MI8kMsw6wCA/exec",
    CARD_BASE_URL: "card.html"
};

let uploadedMedia = null;

document.getElementById("mediaUpload").addEventListener("change", e=>{
    uploadedMedia = e.target.files[0] || null;
});

function showPage(page){
    document.getElementById("dashboardPage").classList.add("hidden");
    document.getElementById("createPage").classList.add("hidden");

    if(page==="dashboard"){
        document.getElementById("dashboardPage").classList.remove("hidden");
    }else{
        document.getElementById("createPage").classList.remove("hidden");
    }
}

async function createCard(){
    const name = document.getElementById("recipientName").value;
    const phone = document.getElementById("whatsappNumber").value;
    const message = document.getElementById("cardMessage").value;
    const theme = document.getElementById("selectedTheme").value;

    if(!name || !phone || !message){
        alert("Lengkapi data dulu");
        return;
    }

    let mediaUrl = "";

    if(uploadedMedia){
        try{
            mediaUrl = await uploadToGoogleDrive(uploadedMedia);
        }catch(e){
            alert("Upload media gagal");
        }
    }

    let cardUrl =
        `${CONFIG.CARD_BASE_URL}?to=${encodeURIComponent(name)}`
        + `&msg=${encodeURIComponent(message)}`
        + `&theme=${theme}`;

    if(mediaUrl){
        cardUrl += `&media=${encodeURIComponent(mediaUrl)}`;
    }

    document.getElementById("result").innerHTML =
        `<a href="${cardUrl}" target="_blank">${cardUrl}</a>`;

    await fetch(CONFIG.SCRIPT_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            type:"card",
            nama:name,
            tema:theme,
            pesan:message,
            link:cardUrl,
            media_url:mediaUrl
        })
    });
}

async function uploadToGoogleDrive(file) {
    const base64Data = await fileToBase64(file);

    const payload = {
        type: "media",
        filename: file.name,
        mimeType: file.type,
        data: base64Data.split(',')[1]
    };

    const response = await fetch(CONFIG.SCRIPT_URL, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
    });

    const result = await response.json();

    if (result.status === "success" && result.url) {
        return result.url;
    } else {
        throw new Error(result.message || "Upload gagal");
    }
}

function fileToBase64(file){
    return new Promise((resolve,reject)=>{
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = ()=>resolve(reader.result);
        reader.onerror = reject;
    });
}
</script>
</body>
</html>
