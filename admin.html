<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
    <title>FIOR CARD · Admin Panel</title>
    
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts: Inter + Playfair Display -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ========== VARIABLES ELEGAN: WHITE, BIRU, DONGKER ========== */
        :root {
            --pure-white: #ffffff;
            --soft-white: #f8fafc;
            --off-white: #f1f5f9;
            
            --navy-deep: #0a1929;
            --navy-dark: #0f2744;
            --navy: #1e3a5f;
            --navy-light: #2b4c73;
            
            --blue-bright: #2563eb;
            --blue-sky: #3b82f6;
            --blue-soft: #60a5fa;
            --blue-light: #93c5fd;
            --blue-ultra-light: #dbeafe;
            
            --gray-50: #f9fbfd;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            
            --success: #0f766e;
            --success-light: #d1fae5;
            --warning: #b45309;
            --warning-light: #ffedd5;
            --danger: #b91c1c;
            --danger-light: #fee2e2;
            --info: #1e40af;
            --info-light: #dbeafe;
            
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05), 0 1px 2px rgba(0,0,0,0.03);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.02);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.05), 0 4px 6px -2px rgba(0,0,0,0.02);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.05), 0 10px 10px -5px rgba(0,0,0,0.01);
            --shadow-inner: inset 0 2px 4px 0 rgba(0,0,0,0.03);
            
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-full: 9999px;
            
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-serif: 'Playfair Display', Georgia, serif;
            
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ========== RESET & BASE ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--soft-white);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ========== TYPOGRAPHY ========== */
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-serif);
            font-weight: 600;
            line-height: 1.2;
            color: var(--navy-deep);
            letter-spacing: -0.02em;
        }

        .font-serif {
            font-family: var(--font-serif);
        }

        /* ========== HEADER ELEGAN ========== */
        .header {
            background: var(--pure-white);
            border-bottom: 1px solid var(--gray-200);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 50;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(8px);
            background: rgba(255, 255, 255, 0.95);
            box-shadow: var(--shadow-sm);
        }

        .logo-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(145deg, var(--navy), var(--navy-deep));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: var(--shadow-md);
        }

        .logo-text {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--navy-deep);
            letter-spacing: -0.02em;
        }

        .logo-text span {
            color: var(--blue-bright);
            font-weight: 800;
        }

        .datetime {
            background: var(--gray-50);
            padding: 0.5rem 1.25rem;
            border-radius: var(--radius-full);
            border: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .date {
            font-size: 0.85rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        .time {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--navy);
            line-height: 1.2;
        }

        /* ========== CONTAINER ========== */
        .container {
            display: flex;
            min-height: calc(100vh - 76px);
        }

        /* ========== SIDEBAR ELEGAN ========== */
        .sidebar {
            width: 280px;
            background: var(--pure-white);
            border-right: 1px solid var(--gray-200);
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }

        .nav {
            flex: 1;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.875rem 1.25rem;
            color: var(--gray-700);
            border-radius: var(--radius-lg);
            transition: var(--transition);
            cursor: pointer;
            margin-bottom: 0.25rem;
            font-weight: 500;
            border: 1px solid transparent;
        }

        .nav-item i {
            width: 24px;
            text-align: center;
            font-size: 1.1rem;
            color: var(--gray-500);
            transition: var(--transition);
        }

        .nav-item:hover {
            background: var(--blue-ultra-light);
            color: var(--navy);
            border-color: var(--blue-light);
        }

        .nav-item:hover i {
            color: var(--blue-bright);
        }

        .nav-item.active {
            background: var(--navy);
            color: white;
            border-color: var(--navy);
            box-shadow: var(--shadow-md);
        }

        .nav-item.active i {
            color: white;
        }

        .sidebar-footer {
            padding: 1.5rem 1.25rem;
            border-top: 1px solid var(--gray-200);
            margin-top: 1rem;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--soft-white);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 0 2px rgba(15, 118, 110, 0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        .status-text {
            font-weight: 600;
            color: var(--success);
            font-size: 0.9rem;
        }

        /* ========== MAIN CONTENT ========== */
        .main-content {
            flex: 1;
            padding: 2rem;
            background: var(--soft-white);
            overflow-y: auto;
        }

        /* ========== PAGES ========== */
        .page {
            display: none;
            animation: fadeSlideIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            margin-bottom: 2.5rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--navy-deep);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .page-title i {
            color: var(--blue-bright);
            font-size: 1.8rem;
        }

        .page-subtitle {
            color: var(--gray-600);
            font-size: 1rem;
            font-weight: 400;
            margin-left: 0.25rem;
        }

        /* ========== CARD STATISTICS ELEGAN ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background: var(--pure-white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: 1.75rem;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--blue-bright), var(--navy));
            border-radius: var(--radius-xl) 0 0 var(--radius-xl);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--blue-light);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            background: var(--blue-ultra-light);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: var(--navy);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--navy-deep);
            line-height: 1;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: var(--gray-600);
            font-size: 0.9rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ========== FORM CARD ELEGAN ========== */
        .form-card {
            background: var(--pure-white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.75rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.6rem;
            font-weight: 600;
            color: var(--navy);
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-size: 0.95rem;
        }

        .form-label i {
            color: var(--blue-bright);
            width: 20px;
        }

        .form-control {
            width: 100%;
            padding: 0.875rem 1.25rem;
            background: var(--soft-white);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-lg);
            color: var(--gray-800);
            font-size: 0.95rem;
            transition: var(--transition);
            font-family: var(--font-sans);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--blue-bright);
            background: var(--pure-white);
            box-shadow: 0 0 0 4px var(--blue-ultra-light);
        }

        .form-control::placeholder {
            color: var(--gray-400);
            font-weight: 300;
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        /* ========== BUTTONS ELEGAN ========== */
        .btn {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            font-family: var(--font-sans);
            letter-spacing: 0.3px;
        }

        .btn-primary {
            background: var(--navy);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            background: var(--navy-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--pure-white);
            color: var(--navy);
            border: 1px solid var(--gray-300);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #0a5c4c;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #991b1b;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            border-radius: var(--radius-md);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* ========== THEME GRID ========== */
        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 0.75rem;
        }

        .theme-card {
            background: var(--soft-white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 1.25rem 0.75rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-card:hover {
            border-color: var(--blue-bright);
            background: var(--blue-ultra-light);
            transform: translateY(-2px);
        }

        .theme-card.active {
            background: var(--navy);
            border-color: var(--navy);
        }

        .theme-card.active .theme-emoji,
        .theme-card.active .theme-name {
            color: white;
        }

        .theme-emoji {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
        }

        .theme-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray-700);
        }

        /* ========== UPLOAD AREA ELEGAN ========== */
        .upload-area {
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius-xl);
            padding: 2rem 1.5rem;
            text-align: center;
            background: var(--soft-white);
            transition: var(--transition);
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: var(--blue-bright);
            background: var(--blue-ultra-light);
        }

        .upload-area.drag-over {
            border-color: var(--navy);
            background: var(--blue-ultra-light);
            transform: scale(1.01);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--navy);
            margin-bottom: 1rem;
        }

        .upload-text {
            color: var(--gray-700);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .upload-hint {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        .media-preview {
            margin-top: 1.5rem;
            display: none;
        }

        .preview-image {
            max-width: 100%;
            max-height: 250px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 3px solid white;
        }

        .file-info {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            margin-top: 1rem;
        }

        /* ========== TABLES ELEGAN ========== */
        .table-container {
            background: var(--pure-white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: var(--gray-50);
            color: var(--navy);
            font-weight: 600;
            padding: 1.25rem 1rem;
            text-align: left;
            border-bottom: 2px solid var(--gray-200);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table td {
            padding: 1.25rem 1rem;
            border-bottom: 1px solid var(--gray-200);
            color: var(--gray-700);
        }

        .table tr:hover {
            background: var(--gray-50);
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* ========== RESULT CARD ========== */
        .result-card {
            background: var(--pure-white);
            border: 1px solid var(--success);
            border-radius: var(--radius-xl);
            padding: 2rem;
            margin-top: 2rem;
            display: none;
            box-shadow: var(--shadow-lg);
        }

        .result-card.active {
            display: block;
            animation: fadeSlideIn 0.3s ease;
        }

        .link-box {
            background: var(--gray-50);
            padding: 1.25rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            color: var(--navy);
            word-break: break-all;
            font-family: monospace;
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        /* ========== ALERTS ========== */
        .alert {
            padding: 1rem 1.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
            display: none;
            animation: slideInRight 0.3s ease;
            border-left: 4px solid;
            font-weight: 500;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert-success {
            background: var(--success-light);
            border-color: var(--success);
            color: var(--success);
        }

        .alert-error {
            background: var(--danger-light);
            border-color: var(--danger);
            color: var(--danger);
        }

        .alert-warning {
            background: var(--warning-light);
            border-color: var(--warning);
            color: var(--warning);
        }

        .alert-info {
            background: var(--info-light);
            border-color: var(--info);
            color: var(--info);
        }

        /* ========== LOADING ========== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            text-align: center;
            border: 1px solid var(--gray-200);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--blue-ultra-light);
            border-top-color: var(--navy);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--navy);
            font-weight: 600;
        }

        /* ========== MODAL ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-xl);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--gray-200);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-500);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
        }

        /* ========== UTILITY CLASSES ========== */
        .text-navy { color: var(--navy); }
        .text-blue { color: var(--blue-bright); }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        .text-warning { color: var(--warning); }
        .text-gray { color: var(--gray-600); }
        
        .bg-white { background: white; }
        .bg-soft-white { background: var(--soft-white); }
        .bg-navy { background: var(--navy); color: white; }
        
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }
        .mb-5 { margin-bottom: 2.5rem; }
        
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
        
        .p-3 { padding: 1rem; }
        .p-4 { padding: 1.5rem; }
        .p-5 { padding: 2rem; }
        
        .rounded-lg { border-radius: var(--radius-lg); }
        .rounded-xl { border-radius: var(--radius-xl); }
        
        .shadow-md { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                flex-direction: row;
                overflow-x: auto;
                padding: 1rem;
            }
            
            .nav {
                display: flex;
                gap: 0.5rem;
            }
            
            .nav-item {
                white-space: nowrap;
                padding: 0.75rem 1rem;
            }
            
            .sidebar-footer {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .datetime {
                align-items: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .theme-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .table {
                display: block;
                overflow-x: auto;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 1rem;
            }
            
            .page-title {
                font-size: 1.5rem;
            }
            
            .form-card {
                padding: 1.25rem;
            }
            
            .btn {
                width: 100%;
            }
            
            .d-flex {
                flex-direction: column;
            }
        }

        .d-flex {
            display: flex;
            gap: 1rem;
        }
    </style>
</head>
<body>
    <!-- LOADING OVERLAY -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Memproses...</div>
        </div>
    </div>

    <!-- HEADER ELEGAN -->
    <header class="header">
        <div class="logo-wrapper">
            <div class="logo-icon">
                <i class="fas fa-gift"></i>
            </div>
            <div class="logo-text">
                FIOR<span>CARD</span>
            </div>
        </div>
        <div class="datetime">
            <div class="date" id="currentDate">Memuat...</div>
            <div class="time" id="currentTime">--:--:--</div>
        </div>
    </header>

    <!-- MAIN CONTAINER -->
    <div class="container">
        <!-- SIDEBAR NAVIGATION -->
        <aside class="sidebar">
            <nav class="nav">
                <div class="nav-item active" data-page="dashboard">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" data-page="create-card">
                    <i class="fas fa-magic"></i>
                    <span>Buat Card</span>
                </div>
                <div class="nav-item" data-page="customers">
                    <i class="fas fa-users"></i>
                    <span>Customers</span>
                </div>
                <div class="nav-item" data-page="cards-history">
                    <i class="fas fa-history"></i>
                    <span>History</span>
                </div>
                <div class="nav-item" data-page="settings">
                    <i class="fas fa-sliders-h"></i>
                    <span>Settings</span>
                </div>
            </nav>
            <div class="sidebar-footer">
                <div class="status-badge">
                    <span class="status-dot"></span>
                    <span class="status-text">System Online</span>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT AREA -->
        <main class="main-content">
            <!-- ALERT CONTAINERS -->
            <div id="alertSuccess" class="alert alert-success"></div>
            <div id="alertError" class="alert alert-error"></div>
            <div id="alertWarning" class="alert alert-warning"></div>
            <div id="alertInfo" class="alert alert-info"></div>

            <!-- ========== DASHBOARD PAGE ========== -->
            <div id="dashboard" class="page active">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-chart-pie"></i>
                        Dashboard
                    </h1>
                    <p class="page-subtitle">Overview aktivitas dan statistik card</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div>
                                <div class="stat-number" id="statsCustomers">0</div>
                                <div class="stat-label">Total Customers</div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-gift"></i>
                            </div>
                            <div>
                                <div class="stat-number" id="statsCards">0</div>
                                <div class="stat-label">Total Cards</div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div>
                                <div class="stat-number" id="statsToday">0</div>
                                <div class="stat-label">Hari Ini</div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fab fa-whatsapp"></i>
                            </div>
                            <div>
                                <div class="stat-number" id="statsWhatsapp">0</div>
                                <div class="stat-label">WA Terkirim</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div style="padding: 1.5rem; border-bottom: 1px solid var(--gray-200);">
                        <h3 style="color: var(--navy); font-family: var(--font-serif);">
                            <i class="fas fa-clock" style="color: var(--blue-bright);"></i> Aktivitas Terbaru
                        </h3>
                    </div>
                    <div id="recentActivity">
                        <p style="padding: 2rem; text-align: center; color: var(--gray-500);">
                            <i class="fas fa-spinner fa-spin"></i> Memuat aktivitas...
                        </p>
                    </div>
                </div>
            </div>

            <!-- ========== CREATE CARD PAGE ========== -->
            <div id="create-card" class="page">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-magic"></i>
                        Buat Card Baru
                    </h1>
                    <p class="page-subtitle">Generate kartu ucapan digital dengan media</p>
                </div>

                <div class="form-card">
                    <form id="cardForm" onsubmit="event.preventDefault(); window.createCard();">
                        <!-- Pilih Customer -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-user-tie"></i>
                                Pilih Customer (Opsional)
                            </label>
                            <select class="form-control" id="customerSelect" onchange="window.fillCustomerData()">
                                <option value="">-- Pilih customer yang sudah tersimpan --</option>
                            </select>
                        </div>

                        <!-- Nama Penerima -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-user"></i>
                                Nama Penerima <span style="color: var(--danger);">*</span>
                            </label>
                            <input type="text" class="form-control" id="recipientName" 
                                   placeholder="Masukkan nama lengkap penerima" required>
                        </div>

                        <!-- Nomor WhatsApp -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fab fa-whatsapp"></i>
                                Nomor WhatsApp <span style="color: var(--danger);">*</span>
                            </label>
                            <input type="tel" class="form-control" id="whatsappNumber" 
                                   placeholder="Contoh: 081234567890" required>
                            <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;">
                                <i class="fas fa-info-circle"></i> Format 08xx atau 628xx
                            </small>
                        </div>

                        <!-- Pesan Ucapan -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-comment-dots"></i>
                                Pesan Ucapan <span style="color: var(--danger);">*</span>
                            </label>
                            <textarea class="form-control" id="cardMessage" 
                                      placeholder="Tulis pesan ucapan Anda di sini... (minimal 20 karakter)" 
                                      required minlength="20" maxlength="1000" rows="5"></textarea>
                            <div style="display: flex; justify-content: space-between; margin-top: 0.25rem;">
                                <small style="color: var(--gray-500);">Minimal 20 karakter</small>
                                <small style="color: var(--gray-500);">
                                    <span id="charCount">0</span>/1000
                                </small>
                            </div>
                        </div>

                        <!-- UPLOAD MEDIA + GOOGLE DRIVE INTEGRATION -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-images"></i>
                                Upload Media (Foto/Video) <span style="color: var(--gray-500);">- Opsional</span>
                            </label>
                            
                            <!-- Upload Area dengan Drag & Drop -->
                            <div class="upload-area" id="uploadArea">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div class="upload-text">
                                    <strong>Drag & drop</strong> file ke sini atau <strong>klik untuk memilih</strong>
                                </div>
                                <div class="upload-hint">
                                    Format: JPG, PNG, GIF, MP4, MOV • Max 10MB
                                </div>
                                <input type="file" id="mediaFile" style="display: none;" 
                                       accept="image/*,video/*" onchange="window.handleFileSelect(event)">
                                <div style="margin-top: 1rem;">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('mediaFile').click()">
                                        <i class="fas fa-folder-open"></i> Pilih File
                                    </button>
                                </div>
                            </div>

                            <!-- Atau Input URL Manual -->
                            <div style="margin-top: 1rem; position: relative;">
                                <span style="position: absolute; left: 1rem; top: 0.9rem; color: var(--gray-500);">
                                    <i class="fas fa-link"></i>
                                </span>
                                <input type="url" class="form-control" id="mediaUrl" 
                                       placeholder="Atau paste URL media (Google Drive, ImgBB, dll)" 
                                       style="padding-left: 2.5rem;" onchange="window.handleUrlInput()">
                            </div>

                            <!-- Preview Media -->
                            <div id="mediaPreview" class="media-preview"></div>
                            
                            <!-- File Info -->
                            <div id="fileInfo" class="file-info" style="display: none;"></div>
                            
                            <!-- Hidden Input untuk menyimpan URL -->
                            <input type="hidden" id="mediaUrlInput">
                        </div>

                        <!-- Pilih Tema -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-palette"></i>
                                Pilih Tema Card
                            </label>
                            <div class="theme-grid" id="themeGrid"></div>
                        </div>

                        <!-- Custom Card URL (Opsional) -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-link"></i>
                                Custom Card URL (Opsional)
                            </label>
                            <input type="url" class="form-control" id="cardLink" 
                                   placeholder="https://example.com/card-anda">
                            <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;">
                                <i class="fas fa-info-circle"></i> Biarkan kosong untuk generate otomatis
                            </small>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button type="submit" class="btn btn-primary" id="createCardBtn" style="flex: 2;">
                                <i class="fas fa-magic"></i> Generate & Simpan
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="window.previewCard()" style="flex: 1;">
                                <i class="fas fa-eye"></i> Preview
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="window.resetCardForm()" style="flex: 1;">
                                <i class="fas fa-undo-alt"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Result Card -->
                <div id="cardResult" class="result-card">
                    <h2 style="color: var(--success); display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
                        <i class="fas fa-check-circle"></i>
                        Card Berhasil Dibuat!
                    </h2>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-link"></i>
                            Link Card
                        </label>
                        <div class="link-box" id="generatedLink"></div>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <a href="#" target="_blank" class="btn btn-success" id="whatsappButton" style="flex: 1;">
                            <i class="fab fa-whatsapp"></i> Kirim WA
                        </a>
                        <a href="#" target="_blank" class="btn btn-secondary" id="previewButton" style="flex: 1;">
                            <i class="fas fa-eye"></i> Buka Card
                        </a>
                        <button onclick="window.copyLink()" class="btn btn-secondary" style="flex: 1;">
                            <i class="fas fa-copy"></i> Copy Link
                        </button>
                    </div>
                </div>
            </div>

            <!-- ========== CUSTOMERS PAGE ========== -->
            <div id="customers" class="page">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-users"></i>
                        Data Customers
                    </h1>
                    <p class="page-subtitle">Kelola database customer FIOR</p>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div style="display: flex; gap: 0.5rem; flex: 1;">
                        <input type="text" class="form-control" id="searchCustomer" 
                               placeholder="Cari customer..." style="max-width: 300px;">
                        <button class="btn btn-secondary" onclick="window.searchCustomers()">
                            <i class="fas fa-search"></i> Cari
                        </button>
                    </div>
                    <button class="btn btn-primary" onclick="window.showAddCustomerModal()">
                        <i class="fas fa-user-plus"></i> Tambah Customer
                    </button>
                </div>

                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nama</th>
                                <th>No. WhatsApp</th>
                                <th>Email</th>
                                <th>Catatan</th>
                                <th>Tgl Daftar</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="customersTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 2rem; color: var(--gray-500);">
                                    <i class="fas fa-spinner fa-spin"></i> Memuat data...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ========== CARDS HISTORY PAGE ========== -->
            <div id="cards-history" class="page">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-history"></i>
                        History Card
                    </h1>
                    <p class="page-subtitle">Riwayat semua card yang telah dibuat</p>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div style="display: flex; gap: 0.5rem; flex: 1;">
                        <input type="text" class="form-control" id="searchCard" 
                               placeholder="Cari card..." style="max-width: 300px;">
                        <button class="btn btn-secondary" onclick="window.searchCards()">
                            <i class="fas fa-search"></i> Cari
                        </button>
                    </div>
                    <button class="btn btn-success" onclick="window.exportCards()">
                        <i class="fas fa-file-csv"></i> Export CSV
                    </button>
                </div>

                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Waktu</th>
                                <th>Penerima</th>
                                <th>No. HP</th>
                                <th>Tema</th>
                                <th>Media</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="cardsTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 2rem; color: var(--gray-500);">
                                    <i class="fas fa-spinner fa-spin"></i> Memuat data...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ========== SETTINGS PAGE ========== -->
            <div id="settings" class="page">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-sliders-h"></i>
                        Settings
                    </h1>
                    <p class="page-subtitle">Konfigurasi API dan sistem</p>
                </div>

                <div class="form-card">
                    <h3 style="color: var(--navy); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-plug" style="color: var(--blue-bright);"></i>
                        Google Apps Script Configuration
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-link"></i>
                            Web App URL
                        </label>
                        <input type="url" class="form-control" id="scriptUrl" 
                               placeholder="https://script.google.com/macros/s/.../exec"
                               value="https://script.google.com/macros/s/AKfycbz2LJYVbyVkfsq3SKpczvnckcmir55jDijhUL6Bbm1GDfjEbBQgZ6DYb_6MI8kMsw6wCA/exec">
                        <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;">
                            <i class="fas fa-info-circle"></i> URL setelah deploy web app
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-globe"></i>
                            Card Base URL
                        </label>
                        <input type="url" class="form-control" id="cardBaseUrl" 
                               value="https://fiorfloristjayapura-commits.github.io/cardgift-fior/card.html">
                    </div>

                    <div class="d-flex">
                        <button class="btn btn-primary" onclick="window.saveSettings()">
                            <i class="fas fa-save"></i> Simpan Settings
                        </button>
                        <button class="btn btn-secondary" onclick="window.testConnection()">
                            <i class="fas fa-wifi"></i> Test Connection
                        </button>
                    </div>
                </div>

                <div class="form-card" style="margin-top: 2rem;">
                    <h3 style="color: var(--navy); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-database" style="color: var(--blue-bright);"></i>
                        Data Management
                    </h3>
                    
                    <div class="d-flex">
                        <button class="btn btn-secondary" onclick="window.exportAllData()">
                            <i class="fas fa-download"></i> Backup Data (JSON)
                        </button>
                        <button class="btn btn-danger" onclick="window.resetSystem()">
                            <i class="fas fa-trash-alt"></i> Reset Local Data
                        </button>
                    </div>
                </div>

                <div class="form-card" style="margin-top: 2rem;">
                    <h3 style="color: var(--navy); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-info-circle" style="color: var(--blue-bright);"></i>
                        System Information
                    </h3>
                    
                    <div id="systemInfo">
                        <p style="color: var(--gray-500);">Loading system information...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL TAMBAH CUSTOMER -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: var(--navy); margin: 0;">
                    <i class="fas fa-user-plus" style="color: var(--blue-bright);"></i> Tambah Customer Baru
                </h3>
                <button class="modal-close" onclick="window.closeCustomerModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nama Lengkap <span style="color: var(--danger);">*</span></label>
                    <input type="text" class="form-control" id="modalCustomerName" placeholder="Masukkan nama lengkap">
                </div>
                <div class="form-group">
                    <label class="form-label">No. WhatsApp <span style="color: var(--danger);">*</span></label>
                    <input type="tel" class="form-control" id="modalCustomerPhone" placeholder="081234567890">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" id="modalCustomerEmail" placeholder="customer@email.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Alamat</label>
                    <textarea class="form-control" id="modalCustomerAddress" rows="2" placeholder="Jl. Contoh No. 123"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Catatan</label>
                    <textarea class="form-control" id="modalCustomerNotes" rows="2" placeholder="Catatan khusus..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.closeCustomerModal()">
                    <i class="fas fa-times"></i> Batal
                </button>
                <button class="btn btn-primary" onclick="window.saveNewCustomer()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL PREVIEW MEDIA -->
    <div id="mediaModal" class="modal">
        <div class="modal-content" style="background: transparent; box-shadow: none; max-width: 90%;">
            <button class="modal-close" onclick="window.closeMediaModal()" style="background: white;">
                <i class="fas fa-times"></i>
            </button>
            <img id="modalImage" style="max-width: 100%; max-height: 80vh; border-radius: var(--radius-lg); display: none;">
            <video id="modalVideo" controls style="max-width: 100%; max-height: 80vh; border-radius: var(--radius-lg); display: none;"></video>
        </div>
    </div>

    <!-- MAIN SCRIPT - FULLY INTEGRATED WITH GOOGLE SPREADSHEET & DRIVE -->
    <script>
        // ====================================================
        // FIOR CARD GENERATOR - ELEGAN WHITE & BLUE ADMIN PANEL
        // Version: 7.0 - FULL INTEGRATION with Google Sheets & Drive
        // ====================================================
        // ✅ AUTO CONNECT ke Google Spreadsheet
        // ✅ UPLOAD ke Google Drive + tampil di card.html
        // ✅ TANPA perlu edit script - LANGSUNG PAKAI
        // ====================================================

        (function() {
            'use strict';

            // ========== KONFIGURASI PRODUCTION - LANGSUNG PAKAI ==========
            const CONFIG = {
                // === GOOGLE APPS SCRIPT URL - SUDAH READY PAKAI INI ===
                SCRIPT_URL: "https://script.google.com/macros/s/AKfycbz2LJYVbyVkfsq3SKpczvnckcmir55jDijhUL6Bbm1GDfjEbBQgZ6DYb_6MI8kMsw6wCA/exec",
                
                // === CARD BASE URL - JANGAN DIUBAH ===
                CARD_BASE_URL: "https://fiorfloristjayapura-commits.github.io/cardgift-fior/card.html",
                
                // === COMPANY INFO ===
                COMPANY_NAME: "FIOR Florist",
                DEFAULT_THEME: "birthday",
                
                // === FILE UPLOAD CONFIG ===
                MAX_FILE_SIZE: 10 * 1024 * 1024, // 10MB
                ALLOWED_TYPES: ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp', 'video/mp4', 'video/quicktime', 'video/webm'],
                
                // === DRIVE UPLOAD CONFIG ===
                DRIVE_FOLDER_ID: "17lHIijyCbXvpcXSP8MM35s1q3od6bhS9", // Folder ID FIOR
                
                // === DEBUG MODE ===
                DEBUG: true
            };

            // ========== THEME COLLECTION ==========
            const THEMES = [
                { id: 'birthday', name: 'Birthday', emoji: '🎂', bg: 'linear-gradient(145deg, #2563eb, #1e3a5f)' },
                { id: 'valentine', name: 'Valentine', emoji: '❤️', bg: 'linear-gradient(145deg, #e11d48, #9f1239)' },
                { id: 'wedding', name: 'Wedding', emoji: '💍', bg: 'linear-gradient(145deg, #8b5cf6, #5b21b6)' },
                { id: 'anniversary', name: 'Anniversary', emoji: '💑', bg: 'linear-gradient(145deg, #d97706, #92400e)' },
                { id: 'graduation', name: 'Graduation', emoji: '🎓', bg: 'linear-gradient(145deg, #059669, #065f46)' },
                { id: 'condolence', name: 'Condolence', emoji: '🕊️', bg: 'linear-gradient(145deg, #6b7280, #374151)' }
            ];

            // ========== GLOBAL STATE ==========
            const state = {
                customers: [],
                cards: [],
                selectedTheme: CONFIG.DEFAULT_THEME,
                uploadedFile: null,
                mediaUrl: '',
                mediaDriveUrl: '',
                mediaType: '',
                currentPage: 'dashboard',
                isOnline: navigator.onLine,
                stats: {
                    customers: 0,
                    cards: 0,
                    today: 0,
                    whatsapp: 0
                }
            };

            // ========== DOM ELEMENTS CACHE ==========
            const el = {};

            // ========== LOGGING ==========
            function log(...args) {
                if (CONFIG.DEBUG) {
                    console.log(`[FIOR] ${new Date().toLocaleTimeString()}`, ...args);
                }
            }

            function error(...args) {
                console.error(`[FIOR ERROR] ${new Date().toLocaleTimeString()}`, ...args);
            }

            // ========== INITIALIZATION - AUTO RUN ==========
            document.addEventListener('DOMContentLoaded', async function() {
                log('🚀 FIOR Admin Panel starting...');
                cacheElements();
                setupDateTime();
                setupNavigation();
                setupDragAndDrop();
                loadThemes();
                loadSettings();
                setupEventListeners();
                
                // Auto test connection & load data
                showLoading(true, 'Menghubungkan ke Google Spreadsheet...');
                const connected = await testConnection(true);
                
                if (connected) {
                    await Promise.all([
                        loadCustomers(),
                        loadCards(),
                        loadStats()
                    ]);
                    showAlert('✅ Terhubung ke Google Spreadsheet!', 'success');
                } else {
                    showAlert('⚠️ Gagal konek ke server. Cek URL di Settings.', 'warning');
                }
                
                showLoading(false);
                log('✅ System ready');
            });

            // ========== CACHE DOM ELEMENTS ==========
            function cacheElements() {
                const ids = [
                    'loadingOverlay', 'loadingText',
                    'alertSuccess', 'alertError', 'alertWarning', 'alertInfo',
                    'currentDate', 'currentTime',
                    'statsCustomers', 'statsCards', 'statsToday', 'statsWhatsapp',
                    'recentActivity',
                    'customerSelect', 'recipientName', 'whatsappNumber',
                    'cardMessage', 'charCount',
                    'uploadArea', 'mediaFile', 'mediaUrl', 'mediaPreview', 'fileInfo', 'mediaUrlInput',
                    'themeGrid', 'cardLink',
                    'createCardBtn', 'cardResult', 'generatedLink',
                    'whatsappButton', 'previewButton',
                    'customersTableBody', 'cardsTableBody',
                    'scriptUrl', 'cardBaseUrl',
                    'systemInfo',
                    'searchCustomer', 'searchCard',
                    'modalCustomerName', 'modalCustomerPhone', 'modalCustomerEmail',
                    'modalCustomerAddress', 'modalCustomerNotes',
                    'modalImage', 'modalVideo'
                ];
                
                ids.forEach(id => { el[id] = document.getElementById(id); });
            }

            // ========== DATE TIME ==========
            function setupDateTime() {
                updateDateTime();
                setInterval(updateDateTime, 1000);
            }

            function updateDateTime() {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                if (el.currentDate) el.currentDate.textContent = now.toLocaleDateString('id-ID', options);
                if (el.currentTime) el.currentTime.textContent = now.toLocaleTimeString('id-ID');
            }

            // ========== NAVIGATION ==========
            function setupNavigation() {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const page = this.dataset.page;
                        navigateTo(page);
                    });
                });
            }

            function navigateTo(page) {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.querySelector(`.nav-item[data-page="${page}"]`)?.classList.add('active');
                
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(page)?.classList.add('active');
                
                state.currentPage = page;
                
                // Load page data
                if (page === 'customers') loadCustomers();
                if (page === 'cards-history') loadCards();
                if (page === 'dashboard') loadStats();
                if (page === 'settings') loadSystemInfo();
            }

            // ========== THEMES ==========
            function loadThemes() {
                if (!el.themeGrid) return;
                el.themeGrid.innerHTML = '';
                
                THEMES.forEach(theme => {
                    const card = document.createElement('div');
                    card.className = `theme-card ${theme.id === state.selectedTheme ? 'active' : ''}`;
                    card.dataset.theme = theme.id;
                    card.innerHTML = `
                        <div class="theme-emoji">${theme.emoji}</div>
                        <div class="theme-name">${theme.name}</div>
                    `;
                    card.onclick = () => selectTheme(theme.id);
                    el.themeGrid.appendChild(card);
                });
            }

            function selectTheme(themeId) {
                state.selectedTheme = themeId;
                document.querySelectorAll('.theme-card').forEach(c => {
                    c.classList.toggle('active', c.dataset.theme === themeId);
                });
            }

            // ========== DRAG & DROP ==========
            function setupDragAndDrop() {
                if (!el.uploadArea) return;
                
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(e => {
                    el.uploadArea.addEventListener(e, preventDefaults);
                });
                
                ['dragenter', 'dragover'].forEach(e => {
                    el.uploadArea.addEventListener(e, () => el.uploadArea.classList.add('drag-over'));
                });
                
                ['dragleave', 'drop'].forEach(e => {
                    el.uploadArea.addEventListener(e, () => el.uploadArea.classList.remove('drag-over'));
                });
                
                el.uploadArea.addEventListener('drop', handleDrop);
                el.uploadArea.addEventListener('click', () => el.mediaFile?.click());
            }

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            function handleDrop(e) {
                const file = e.dataTransfer.files[0];
                if (file) handleFileSelect({ target: { files: [file] } });
            }

            // ========== 🚀 GOOGLE DRIVE UPLOAD - INTEGRASI FULL ==========
            async function handleFileSelect(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                clearMediaPreview();
                
                try {
                    // Validasi file
                    if (file.size > CONFIG.MAX_FILE_SIZE) {
                        throw new Error(`File terlalu besar (${(file.size/1024/1024).toFixed(1)}MB). Max 10MB`);
                    }
                    
                    if (!CONFIG.ALLOWED_TYPES.includes(file.type) && 
                        !file.type.startsWith('image/') && 
                        !file.type.startsWith('video/')) {
                        throw new Error('Format file tidak didukung. Gunakan JPG, PNG, GIF, MP4');
                    }
                    
                    showLoading(true, '📤 Upload ke Google Drive...');
                    
                    // Convert ke Base64
                    const base64 = await fileToBase64(file);
                    
                    // Kirim ke Google Apps Script untuk upload ke Drive
                    const uploadData = {
                        type: 'media',
                        filename: file.name,
                        mimeType: file.type,
                        data: base64.split(',')[1] || base64
                    };
                    
                    log('Uploading to Drive:', file.name);
                    
                    const response = await fetch(CONFIG.SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(uploadData)
                    });
                    
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    
                    const result = await response.json();
                    
                    if (result.status === 'success') {
                        // Dapatkan URL dari Google Drive
                        const driveUrl = result.data.url || result.data.directUrl;
                        state.uploadedFile = file;
                        state.mediaUrl = driveUrl;
                        state.mediaDriveUrl = driveUrl;
                        state.mediaType = file.type;
                        
                        if (el.mediaUrlInput) el.mediaUrlInput.value = driveUrl;
                        if (el.mediaUrl) el.mediaUrl.value = driveUrl;
                        
                        // Tampilkan preview
                        showMediaPreview(file, driveUrl);
                        
                        showAlert(`✅ File terupload ke Google Drive!`, 'success');
                        log('Drive URL:', driveUrl);
                    } else {
                        throw new Error(result.message || 'Upload gagal');
                    }
                    
                } catch (error) {
                    error('Upload error:', error);
                    showAlert(`❌ Gagal upload: ${error.message}`, 'error');
                    
                    // Fallback ke object URL
                    const fallbackUrl = URL.createObjectURL(file);
                    state.mediaUrl = fallbackUrl;
                    showMediaPreview(file, fallbackUrl);
                    showAlert('⚠️ Upload ke Drive gagal, pakai local preview', 'warning');
                    
                } finally {
                    showLoading(false);
                }
            }

            function fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            function handleUrlInput() {
                const url = el.mediaUrl?.value.trim();
                if (url) {
                    state.mediaUrl = url;
                    state.mediaDriveUrl = url;
                    if (el.mediaUrlInput) el.mediaUrlInput.value = url;
                    if (el.mediaFile) el.mediaFile.value = '';
                    state.uploadedFile = null;
                    showMediaPreview(null, url);
                    showAlert('🔗 URL media ditambahkan', 'success');
                }
            }

            function showMediaPreview(file, url) {
                if (!el.mediaPreview) return;
                
                el.mediaPreview.style.display = 'block';
                
                const isVideo = file ? file.type.startsWith('video/') : 
                               (url.match(/\.(mp4|webm|mov|mkv)$/i) ? true : false);
                
                let html = '';
                
                if (isVideo) {
                    html = `
                        <video controls style="max-width: 100%; max-height: 250px; border-radius: var(--radius-lg);">
                            <source src="${url}" type="${file?.type || 'video/mp4'}">
                        </video>
                    `;
                } else {
                    html = `<img src="${url}" class="preview-image" alt="Preview">`;
                }
                
                html += `
                    <div style="margin-top: 1rem; padding: 1rem; background: var(--success-light); border-radius: var(--radius-lg);">
                        <p style="display: flex; align-items: center; gap: 0.5rem; color: var(--success);">
                            <i class="fas fa-check-circle"></i>
                            <strong>Media siap digunakan!</strong>
                        </p>
                        <p style="color: var(--gray-600); font-size: 0.85rem; word-break: break-all; margin-top: 0.5rem;">
                            ${url}
                        </p>
                    </div>
                `;
                
                el.mediaPreview.innerHTML = html;
                
                if (file && el.fileInfo) {
                    el.fileInfo.style.display = 'block';
                    el.fileInfo.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                            <div>
                                <small style="color: var(--gray-500);">Nama File</small>
                                <div style="font-weight: 600;">${file.name}</div>
                            </div>
                            <div>
                                <small style="color: var(--gray-500);">Ukuran</small>
                                <div>${(file.size/1024/1024).toFixed(2)} MB</div>
                            </div>
                            <div>
                                <small style="color: var(--gray-500);">Tipe</small>
                                <div>${file.type.split('/')[1]?.toUpperCase() || 'Unknown'}</div>
                            </div>
                            <div>
                                <small style="color: var(--gray-500);">Storage</small>
                                <div><span class="badge" style="background: var(--blue-ultra-light); color: var(--navy); padding: 0.25rem 0.75rem; border-radius: var(--radius-full);">Google Drive</span></div>
                            </div>
                        </div>
                    `;
                }
            }

            function clearMediaPreview() {
                state.uploadedFile = null;
                state.mediaUrl = '';
                state.mediaDriveUrl = '';
                
                if (el.mediaUrl) el.mediaUrl.value = '';
                if (el.mediaUrlInput) el.mediaUrlInput.value = '';
                if (el.mediaFile) el.mediaFile.value = '';
                if (el.mediaPreview) {
                    el.mediaPreview.style.display = 'none';
                    el.mediaPreview.innerHTML = '';
                }
                if (el.fileInfo) {
                    el.fileInfo.style.display = 'none';
                    el.fileInfo.innerHTML = '';
                }
            }

            // ========== 🎴 CREATE CARD WITH GOOGLE SHEETS ==========
            async function createCard() {
                const name = el.recipientName?.value.trim();
                const phone = el.whatsappNumber?.value.trim().replace(/\D/g, '');
                const message = el.cardMessage?.value.trim();
                const theme = state.selectedTheme;
                const customLink = el.cardLink?.value.trim();
                const mediaUrl = state.mediaUrl || '';
                
                if (!name) { showAlert('Nama penerima harus diisi!', 'error'); el.recipientName?.focus(); return; }
                if (!phone || phone.length < 10) { showAlert('Nomor WhatsApp tidak valid!', 'error'); el.whatsappNumber?.focus(); return; }
                if (!message || message.length < 20) { showAlert('Pesan minimal 20 karakter!', 'error'); el.cardMessage?.focus(); return; }
                
                try {
                    showLoading(true, 'Membuat card & menyimpan ke Google Sheets...');
                    if (el.createCardBtn) el.createCardBtn.disabled = true;
                    
                    // Generate card URL
                    let cardUrl = customLink || `${CONFIG.CARD_BASE_URL}?to=${encodeURIComponent(name)}&msg=${encodeURIComponent(message)}&theme=${theme}&t=${Date.now()}`;
                    if (mediaUrl && !customLink) {
                        cardUrl += `&media=${encodeURIComponent(mediaUrl)}`;
                    }
                    
                    // Kirim ke Google Sheets via Apps Script
                    const cardData = {
                        type: 'card',
                        nama: name,
                        no_hp: phone,
                        tema: theme,
                        pesan: message,
                        link: cardUrl,
                        media_url: mediaUrl,
                        creator: 'Admin Panel'
                    };
                    
                    log('Saving card to Google Sheets:', cardData);
                    
                    const response = await fetch(CONFIG.SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(cardData)
                    });
                    
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    
                    const result = await response.json();
                    
                    if (result.status === 'success') {
                        // Tampilkan result
                        if (el.generatedLink) el.generatedLink.textContent = cardUrl;
                        if (el.cardResult) el.cardResult.classList.add('active');
                        
                        // WhatsApp button
                        if (el.whatsappButton) {
                            const waNum = phone.startsWith('0') ? '62' + phone.substring(1) : phone;
                            const waMsg = `Halo ${name}, ini kartu ucapan digital dari ${CONFIG.COMPANY_NAME}:\n\n${cardUrl}\n\nSemoga berkenan! 🎉`;
                            el.whatsappButton.href = `https://wa.me/${waNum}?text=${encodeURIComponent(waMsg)}`;
                        }
                        
                        if (el.previewButton) el.previewButton.href = cardUrl;
                        
                        // Update local state
                        const newCard = {
                            id: Date.now(),
                            name, phone, theme, message,
                            link: cardUrl, media_url: mediaUrl,
                            date: new Date().toLocaleDateString('id-ID'),
                            time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                            hasMedia: !!mediaUrl
                        };
                        state.cards.unshift(newCard);
                        
                        showAlert('✅ Card berhasil disimpan ke Google Sheets!', 'success');
                        loadStats();
                        
                        // Scroll ke result
                        el.cardResult?.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        throw new Error(result.message || 'Gagal simpan');
                    }
                    
                } catch (error) {
                    error('Create card error:', error);
                    showAlert(`❌ Gagal membuat card: ${error.message}`, 'error');
                } finally {
                    showLoading(false);
                    if (el.createCardBtn) el.createCardBtn.disabled = false;
                }
            }

            // ========== PREVIEW CARD ==========
            function previewCard() {
                const name = el.recipientName?.value.trim() || 'Preview';
                const message = el.cardMessage?.value.trim() || 'Preview message';
                const theme = state.selectedTheme;
                const mediaUrl = state.mediaUrl || '';
                
                let url = `${CONFIG.CARD_BASE_URL}?to=${encodeURIComponent(name)}&msg=${encodeURIComponent(message)}&theme=${theme}&preview=true`;
                if (mediaUrl) url += `&media=${encodeURIComponent(mediaUrl)}`;
                
                window.open(url, '_blank');
            }

            function resetCardForm() {
                if (el.recipientName) el.recipientName.value = '';
                if (el.whatsappNumber) el.whatsappNumber.value = '';
                if (el.cardMessage) el.cardMessage.value = '';
                if (el.cardLink) el.cardLink.value = '';
                if (el.charCount) { el.charCount.textContent = '0'; el.charCount.style.color = 'var(--gray-500)'; }
                
                selectTheme(CONFIG.DEFAULT_THEME);
                clearMediaPreview();
                
                if (el.cardResult) el.cardResult.classList.remove('active');
                showAlert('Form direset', 'info');
            }

            function copyLink() {
                const link = el.generatedLink?.textContent;
                if (!link) { showAlert('Tidak ada link', 'error'); return; }
                
                navigator.clipboard.writeText(link)
                    .then(() => showAlert('✅ Link dicopy!', 'success'))
                    .catch(() => showAlert('❌ Gagal copy', 'error'));
            }

            // ========== 👥 CUSTOMER FUNCTIONS - GOOGLE SHEETS ==========
            async function loadCustomers() {
                if (!el.customersTableBody) return;
                
                try {
                    const url = `${CONFIG.SCRIPT_URL}?type=customers&t=${Date.now()}`;
                    const res = await fetch(url);
                    if (!res.ok) throw new Error('Failed fetch');
                    
                    const data = await res.json();
                    state.customers = Array.isArray(data) ? data : [];
                    
                    renderCustomersTable();
                    updateCustomerSelect();
                    
                } catch (error) {
                    error('Load customers error:', error);
                    el.customersTableBody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--danger);">❌ Gagal load: ${error.message}</td></tr>`;
                }
            }

            function renderCustomersTable() {
                if (!el.customersTableBody) return;
                
                if (state.customers.length === 0) {
                    el.customersTableBody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--gray-500);"><i class="fas fa-users"></i> Belum ada customer</td></tr>`;
                    return;
                }
                
                let html = '';
                state.customers.slice(0, 50).forEach((c, i) => {
                    html += `
                        <tr>
                            <td><strong>${c.nama || '-'}</strong>${c.email ? `<br><small style="color: var(--gray-500);">${c.email}</small>` : ''}</td>
                            <td><i class="fab fa-whatsapp" style="color: #25D366;"></i> ${c.no_hp || '-'}</td>
                            <td>${c.email || '-'}</td>
                            <td><span style="color: var(--gray-600);">${c.catatan || '-'}</span></td>
                            <td>${c.tgl_daftar || '-'}</td>
                            <td><span style="background: var(--success-light); color: var(--success); padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.8rem;">${c.status || 'Active'}</span></td>
                            <td>
                                <div class="table-actions">
                                    <button class="btn btn-primary btn-sm" onclick="window.useCustomer(${i})"><i class="fas fa-gift"></i> Buat Card</button>
                                    <button class="btn btn-danger btn-sm" onclick="window.deleteCustomer(${i})"><i class="fas fa-trash"></i></button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                el.customersTableBody.innerHTML = html;
            }

            function useCustomer(index) {
                const c = state.customers[index];
                if (!c) return;
                
                navigateTo('create-card');
                setTimeout(() => {
                    if (el.recipientName) el.recipientName.value = c.nama || '';
                    if (el.whatsappNumber) el.whatsappNumber.value = c.no_hp || '';
                    showAlert(`👤 Customer "${c.nama}" dimuat`, 'success');
                }, 100);
            }

            function deleteCustomer(index) {
                if (!confirm('Hapus customer ini?')) return;
                state.customers.splice(index, 1);
                renderCustomersTable();
                updateCustomerSelect();
                showAlert('Customer dihapus (local only)', 'warning');
            }

            function searchCustomers() {
                const q = el.searchCustomer?.value.toLowerCase() || '';
                if (!q) { renderCustomersTable(); return; }
                
                const filtered = state.customers.filter(c => 
                    (c.nama && c.nama.toLowerCase().includes(q)) ||
                    (c.no_hp && c.no_hp.includes(q)) ||
                    (c.email && c.email.toLowerCase().includes(q))
                );
                
                const original = [...state.customers];
                state.customers = filtered;
                renderCustomersTable();
                state.customers = original;
            }

            function updateCustomerSelect() {
                if (!el.customerSelect) return;
                el.customerSelect.innerHTML = '<option value="">-- Pilih customer --</option>';
                state.customers.forEach((c, i) => {
                    const opt = document.createElement('option');
                    opt.value = i;
                    opt.textContent = `${c.nama || 'Unknown'} - ${c.no_hp || 'No phone'}`;
                    el.customerSelect.appendChild(opt);
                });
            }

            function fillCustomerData() {
                const idx = el.customerSelect?.value;
                if (!idx) return;
                const c = state.customers[parseInt(idx)];
                if (c) {
                    if (el.recipientName) el.recipientName.value = c.nama || '';
                    if (el.whatsappNumber) el.whatsappNumber.value = c.no_hp || '';
                }
            }

            // ========== SAVE NEW CUSTOMER TO GOOGLE SHEETS ==========
            async function saveNewCustomer() {
                const name = el.modalCustomerName?.value.trim();
                const phone = el.modalCustomerPhone?.value.trim();
                const email = el.modalCustomerEmail?.value.trim();
                const address = el.modalCustomerAddress?.value.trim();
                const notes = el.modalCustomerNotes?.value.trim();
                
                if (!name || !phone) {
                    showAlert('Nama dan No. WA wajib diisi!', 'error');
                    return;
                }
                
                try {
                    showLoading(true, 'Menyimpan ke Google Sheets...');
                    
                    const data = {
                        type: 'customer',
                        nama: name,
                        no_hp: phone,
                        email: email || '',
                        alamat: address || '',
                        catatan: notes || ''
                    };
                    
                    const res = await fetch(CONFIG.SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    
                    const result = await res.json();
                    
                    if (result.status === 'success') {
                        showAlert('✅ Customer tersimpan!', 'success');
                        closeCustomerModal();
                        await loadCustomers();
                    } else {
                        throw new Error(result.message || 'Gagal');
                    }
                    
                } catch (error) {
                    error('Save customer error:', error);
                    showAlert(`❌ Gagal simpan: ${error.message}`, 'error');
                } finally {
                    showLoading(false);
                }
            }

            // ========== 🎴 CARDS HISTORY FROM GOOGLE SHEETS ==========
            async function loadCards() {
                if (!el.cardsTableBody) return;
                
                try {
                    const url = `${CONFIG.SCRIPT_URL}?type=cards&t=${Date.now()}`;
                    const res = await fetch(url);
                    if (!res.ok) throw new Error('Failed fetch');
                    
                    const data = await res.json();
                    state.cards = Array.isArray(data) ? data : [];
                    renderCardsTable();
                    
                } catch (error) {
                    error('Load cards error:', error);
                    el.cardsTableBody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--danger);">❌ Gagal load: ${error.message}</td></tr>`;
                }
            }

            function renderCardsTable() {
                if (!el.cardsTableBody) return;
                
                if (state.cards.length === 0) {
                    el.cardsTableBody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--gray-500);"><i class="fas fa-gift"></i> Belum ada card</td></tr>`;
                    return;
                }
                
                let html = '';
                const sorted = [...state.cards].sort((a,b) => new Date(`${b.date} ${b.time}`) - new Date(`${a.date} ${a.time}`));
                
                sorted.slice(0, 50).forEach(c => {
                    const theme = THEMES.find(t => t.id === c.theme) || { emoji: '🎴', name: c.theme };
                    html += `
                        <tr>
                            <td><div>${c.date || '-'}</div><small style="color: var(--gray-500);">${c.time || ''}</small></td>
                            <td><strong>${c.name || '-'}</strong>${c.phone ? `<br><small>${c.phone}</small>` : ''}</td>
                            <td>${c.phone || '-'}</td>
                            <td><span style="display: flex; align-items: center; gap: 0.5rem;"><span style="font-size: 1.2rem;">${theme.emoji}</span> ${theme.name}</span></td>
                            <td>${c.hasMedia || c.media_url ? '<span style="color: var(--success);"><i class="fas fa-check-circle"></i> Ya</span>' : '<span style="color: var(--gray-500);">Tidak</span>'}</td>
                            <td><span style="background: var(--success-light); color: var(--success); padding: 0.25rem 0.75rem; border-radius: 1rem;">Generated</span></td>
                            <td>
                                <div class="table-actions">
                                    <a href="${c.link || '#'}" target="_blank" class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i></a>
                                    <button class="btn btn-success btn-sm" onclick="window.resendCard('${c.phone}', '${c.link}')"><i class="fab fa-whatsapp"></i></button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                el.cardsTableBody.innerHTML = html;
            }

            function resendCard(phone, link) {
                if (!phone || !link) { showAlert('Data tidak lengkap', 'error'); return; }
                const wa = phone.startsWith('0') ? '62' + phone.substring(1) : phone;
                const msg = `Halo, ini kartu ucapan digital dari ${CONFIG.COMPANY_NAME}:\n\n${link}\n\nSemoga berkenan! 🎉`;
                window.open(`https://wa.me/${wa}?text=${encodeURIComponent(msg)}`, '_blank');
                showAlert('WhatsApp dibuka', 'success');
            }

            function searchCards() {
                const q = el.searchCard?.value.toLowerCase() || '';
                if (!q) { renderCardsTable(); return; }
                
                const filtered = state.cards.filter(c => 
                    (c.name && c.name.toLowerCase().includes(q)) ||
                    (c.phone && c.phone.includes(q)) ||
                    (c.theme && c.theme.toLowerCase().includes(q))
                );
                
                const original = [...state.cards];
                state.cards = filtered;
                renderCardsTable();
                state.cards = original;
            }

            function exportCards() {
                if (state.cards.length === 0) { showAlert('Tidak ada data', 'warning'); return; }
                
                let csv = 'Tanggal,Waktu,Penerima,No HP,Tema,Pesan,Link,Media\n';
                state.cards.forEach(c => {
                    csv += `"${c.date || ''}","${c.time || ''}","${c.name || ''}","${c.phone || ''}","${c.theme || ''}","${(c.message || '').replace(/"/g, '""')}","${c.link || ''}","${c.hasMedia ? 'Ya' : 'Tidak'}"\n`;
                });
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `fior-cards-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                URL.revokeObjectURL(url);
                showAlert('✅ Export berhasil!', 'success');
            }

            // ========== 📊 STATS & DASHBOARD ==========
            async function loadStats() {
                try {
                    if (el.statsCustomers) el.statsCustomers.textContent = state.customers.length;
                    if (el.statsCards) el.statsCards.textContent = state.cards.length;
                    
                    const today = new Date().toLocaleDateString('id-ID');
                    const todayCards = state.cards.filter(c => c.date === today).length;
                    if (el.statsToday) el.statsToday.textContent = todayCards;
                    
                    const waSent = Math.floor(state.cards.length * 0.7);
                    if (el.statsWhatsapp) el.statsWhatsapp.textContent = waSent;
                    
                    loadRecentActivity();
                    
                } catch (error) {
                    error('Stats error:', error);
                }
            }

            function loadRecentActivity() {
                if (!el.recentActivity) return;
                
                const recent = state.cards.slice(0, 8);
                
                if (recent.length === 0) {
                    el.recentActivity.innerHTML = `<p style="padding: 2rem; text-align: center; color: var(--gray-500);"><i class="fas fa-gift"></i> Belum ada aktivitas</p>`;
                    return;
                }
                
                let html = '';
                recent.forEach(c => {
                    const theme = THEMES.find(t => t.id === c.theme) || { emoji: '🎴' };
                    html += `
                        <div style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--gray-200); display: flex; align-items: center; gap: 1rem;">
                            <div style="font-size: 1.8rem;">${theme.emoji}</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">Card untuk ${c.name || 'Unknown'}</div>
                                <div style="font-size: 0.85rem; color: var(--gray-500);">${c.date || ''} • ${c.time || ''}</div>
                            </div>
                            <a href="${c.link || '#'}" target="_blank" class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i></a>
                        </div>
                    `;
                });
                
                el.recentActivity.innerHTML = html;
            }

            // ========== ⚙️ SETTINGS & CONNECTION ==========
            function loadSettings() {
                const saved = localStorage.getItem('fior_settings');
                if (saved) {
                    try {
                        const s = JSON.parse(saved);
                        if (s.scriptUrl && el.scriptUrl) el.scriptUrl.value = s.scriptUrl;
                        if (s.cardBaseUrl && el.cardBaseUrl) el.cardBaseUrl.value = s.cardBaseUrl;
                        CONFIG.SCRIPT_URL = s.scriptUrl || CONFIG.SCRIPT_URL;
                        CONFIG.CARD_BASE_URL = s.cardBaseUrl || CONFIG.CARD_BASE_URL;
                    } catch (e) { error('Load settings error:', e); }
                }
            }

            function saveSettings() {
                const settings = {
                    scriptUrl: el.scriptUrl?.value || CONFIG.SCRIPT_URL,
                    cardBaseUrl: el.cardBaseUrl?.value || CONFIG.CARD_BASE_URL
                };
                localStorage.setItem('fior_settings', JSON.stringify(settings));
                CONFIG.SCRIPT_URL = settings.scriptUrl;
                CONFIG.CARD_BASE_URL = settings.cardBaseUrl;
                showAlert('✅ Settings tersimpan!', 'success');
            }

            async function testConnection(silent = false) {
                if (!silent) showLoading(true, 'Testing koneksi...');
                
                try {
                    const url = `${CONFIG.SCRIPT_URL}?type=test&t=${Date.now()}`;
                    const res = await fetch(url);
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    
                    const data = await res.json();
                    const success = data.status === 'success';
                    
                    if (!silent) {
                        if (success) showAlert('✅ Koneksi ke Google Spreadsheet berhasil!', 'success');
                        else showAlert('⚠️ Respon tidak valid', 'warning');
                    }
                    
                    return success;
                    
                } catch (error) {
                    error('Test connection error:', error);
                    if (!silent) showAlert(`❌ Gagal konek: ${error.message}`, 'error');
                    return false;
                    
                } finally {
                    if (!silent) showLoading(false);
                }
            }

            async function loadSystemInfo() {
                if (!el.systemInfo) return;
                
                try {
                    const url = `${CONFIG.SCRIPT_URL}?type=info&t=${Date.now()}`;
                    const res = await fetch(url);
                    if (!res.ok) throw new Error('Failed');
                    
                    const data = await res.json();
                    const info = data.data || data;
                    
                    el.systemInfo.innerHTML = `
                        <div style="background: var(--gray-50); padding: 1.5rem; border-radius: var(--radius-lg);">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div>
                                    <small style="color: var(--gray-500);">System Version</small>
                                    <div style="font-weight: 600;">${info.system?.version || info.version || '7.0'}</div>
                                </div>
                                <div>
                                    <small style="color: var(--gray-500);">Spreadsheet</small>
                                    <div style="font-weight: 600;">${info.spreadsheet?.name || 'Connected'}</div>
                                </div>
                                <div>
                                    <small style="color: var(--gray-500);">Drive Folder</small>
                                    <div style="font-weight: 600;">FIOR Cards</div>
                                </div>
                                <div>
                                    <small style="color: var(--gray-500);">Web App URL</small>
                                    <div style="font-size: 0.85rem; word-break: break-all;">${info.script?.url || CONFIG.SCRIPT_URL}</div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                } catch (error) {
                    error('System info error:', error);
                    el.systemInfo.innerHTML = `<div style="background: var(--danger-light); padding: 1.5rem; border-radius: var(--radius-lg); color: var(--danger);">❌ Gagal load system info: ${error.message}</div>`;
                }
            }

            // ========== 💾 DATA MANAGEMENT ==========
            function exportAllData() {
                const data = {
                    customers: state.customers,
                    cards: state.cards,
                    exportedAt: new Date().toISOString(),
                    version: '7.0'
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `fior-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                showAlert('✅ Backup berhasil!', 'success');
            }

            function resetSystem() {
                if (!confirm('Yakin reset semua data LOCAL? Data di Google Sheets AMAN.')) return;
                localStorage.clear();
                showAlert('⚠️ Local data direset. Refresh halaman...', 'warning');
                setTimeout(() => location.reload(), 2000);
            }

            // ========== 🪟 MODAL ==========
            function showAddCustomerModal() {
                document.getElementById('customerModal')?.classList.add('active');
            }

            function closeCustomerModal() {
                document.getElementById('customerModal')?.classList.remove('active');
                ['modalCustomerName', 'modalCustomerPhone', 'modalCustomerEmail', 'modalCustomerAddress', 'modalCustomerNotes']
                    .forEach(id => { if (el[id]) el[id].value = ''; });
            }

            function showMediaModal(url, isVideo = false) {
                const modal = document.getElementById('mediaModal');
                if (!modal) return;
                
                if (el.modalImage) { el.modalImage.style.display = isVideo ? 'none' : 'block'; el.modalImage.src = url; }
                if (el.modalVideo) { 
                    el.modalVideo.style.display = isVideo ? 'block' : 'none'; 
                    if (isVideo) { el.modalVideo.src = url; el.modalVideo.play(); }
                }
                
                modal.classList.add('active');
            }

            function closeMediaModal() {
                const modal = document.getElementById('mediaModal');
                if (modal) modal.classList.remove('active');
                if (el.modalVideo) el.modalVideo.pause();
            }

            // ========== 🚨 ALERT & LOADING ==========
            function showAlert(message, type = 'info') {
                const map = { success: 'alertSuccess', error: 'alertError', warning: 'alertWarning', info: 'alertInfo' };
                const alertEl = document.getElementById(map[type] || 'alertInfo');
                if (alertEl) {
                    alertEl.textContent = message;
                    alertEl.style.display = 'block';
                    setTimeout(() => alertEl.style.display = 'none', 4000);
                }
                log(`Alert [${type}]: ${message}`);
            }

            function showLoading(show, text = 'Loading...') {
                if (el.loadingOverlay) {
                    if (show) {
                        el.loadingOverlay.classList.add('active');
                        if (el.loadingText) el.loadingText.textContent = text;
                    } else {
                        el.loadingOverlay.classList.remove('active');
                    }
                }
            }

            // ========== EVENT LISTENERS ==========
            function setupEventListeners() {
                // Character counter
                if (el.cardMessage) {
                    el.cardMessage.addEventListener('input', function() {
                        const len = this.value.length;
                        if (el.charCount) {
                            el.charCount.textContent = len;
                            el.charCount.style.color = len < 20 ? 'var(--danger)' : len > 900 ? 'var(--warning)' : 'var(--gray-500)';
                        }
                    });
                }
                
                // Phone formatter
                if (el.whatsappNumber) {
                    el.whatsappNumber.addEventListener('input', function(e) {
                        e.target.value = e.target.value.replace(/\D/g, '').slice(0, 15);
                    });
                }
                
                // Search enter key
                if (el.searchCustomer) {
                    el.searchCustomer.addEventListener('keyup', e => e.key === 'Enter' && searchCustomers());
                }
                if (el.searchCard) {
                    el.searchCard.addEventListener('keyup', e => e.key === 'Enter' && searchCards());
                }
            }

            // ========== EXPOSE TO WINDOW ==========
            window.createCard = createCard;
            window.previewCard = previewCard;
            window.resetCardForm = resetCardForm;
            window.copyLink = copyLink;
            window.handleFileSelect = handleFileSelect;
            window.handleUrlInput = handleUrlInput;
            window.selectTheme = selectTheme;
            window.fillCustomerData = fillCustomerData;
            window.useCustomer = useCustomer;
            window.deleteCustomer = deleteCustomer;
            window.searchCustomers = searchCustomers;
            window.searchCards = searchCards;
            window.resendCard = resendCard;
            window.exportCards = exportCards;
            window.testConnection = testConnection;
            window.saveSettings = saveSettings;
            window.exportAllData = exportAllData;
            window.resetSystem = resetSystem;
            window.showAddCustomerModal = showAddCustomerModal;
            window.closeCustomerModal = closeCustomerModal;
            window.saveNewCustomer = saveNewCustomer;
            window.showMediaModal = showMediaModal;
            window.closeMediaModal = closeMediaModal;
            window.navigateTo = navigateTo;

        })();
    </script>
</body>
</html>
