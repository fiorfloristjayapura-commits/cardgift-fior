<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIOR Cards - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fb;
            color: #333;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #4361ee, #3a0ca3);
            color: white;
            padding: 20px 0;
        }
        
        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .logo p {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .nav {
            list-style: none;
        }
        
        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-item:hover,
        .nav-item.active {
            background: rgba(255,255,255,0.1);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #4361ee;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Tables */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        
        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #4361ee;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3a0ca3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        /* Badges */
        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-secondary {
            background: #e2e3e5;
            color: #383d41;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4361ee;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(150%);
            transition: transform 0.3s;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-success {
            border-left: 4px solid #28a745;
        }
        
        .toast-error {
            border-left: 4px solid #dc3545;
        }
        
        .toast-info {
            border-left: 4px solid #17a2b8;
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4361ee;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Status */
        .api-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .status-online {
            background: #d4edda;
            color: #155724;
        }
        
        .status-offline {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1>üé¥ FIOR Cards</h1>
                <p>Admin Panel</p>
            </div>
            
            <ul class="nav">
                <li class="nav-item active" onclick="showPage('dashboard')">
                    üìä Dashboard
                </li>
                <li class="nav-item" onclick="showPage('cards')">
                    üé¥ Kartu Ucapan
                </li>
                <li class="nav-item" onclick="showPage('customers')">
                    üë• Pelanggan
                </li>
                <li class="nav-item" onclick="showPage('settings')">
                    ‚öôÔ∏è Pengaturan
                </li>
            </ul>
            
            <div style="padding: 20px; margin-top: auto;">
                <div class="api-status status-offline" id="apiStatus">
                    <span class="loading"></span>
                    <span id="statusText">Checking API...</span>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div>
                    <h2 id="pageTitle">Dashboard</h2>
                    <p id="pageSubtitle">Selamat datang di admin panel FIOR Cards</p>
                </div>
                <div>
                    <button class="btn btn-primary" onclick="showModal('config')">
                        ‚öôÔ∏è Konfigurasi API
                    </button>
                </div>
            </div>
            
            <!-- Content Area -->
            <div id="contentArea">
                <!-- Dashboard will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    
    <!-- Modals -->
    <div class="modal" id="configModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Konfigurasi API</h3>
                <button onclick="hideModal('config')" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>URL Google Apps Script</label>
                    <input type="text" id="apiUrl" 
                           placeholder="https://script.google.com/macros/s/.../exec">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        Salin URL dari Google Apps Script setelah deploy
                    </small>
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 15px 0;">
                    <h4 style="margin-bottom: 10px;">üìù Cara Deploy:</h4>
                    <ol style="margin-left: 20px; line-height: 1.6;">
                        <li>Buka Google Sheets</li>
                        <li>Ekstensi > Apps Script</li>
                        <li>Paste kode dan Save</li>
                        <li>Klik Deploy > New deployment</li>
                        <li>Pilih Web app</li>
                        <li>Set "Execute as" = Me</li>
                        <li>Set "Who has access" = Anyone</li>
                        <li>Klik Deploy dan salin URL</li>
                    </ol>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="hideModal('config')" style="background: #6c757d; color: white;">Batal</button>
                <button class="btn btn-primary" onclick="saveApiUrl()">Simpan</button>
            </div>
        </div>
    </div>
    
    <!-- Add Customer Modal -->
    <div class="modal" id="addCustomerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üë§ Tambah Pelanggan</h3>
                <button onclick="hideModal('addCustomer')" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nama *</label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label>No HP *</label>
                    <input type="tel" id="customerPhone" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="customerEmail">
                </div>
                <div class="form-group">
                    <label>Alamat</label>
                    <textarea id="customerAddress" rows="2"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="hideModal('addCustomer')" style="background: #6c757d; color: white;">Batal</button>
                <button class="btn btn-success" onclick="saveCustomer()">Simpan</button>
            </div>
        </div>
    </div>
    
    <!-- Add Card Modal -->
    <div class="modal" id="addCardModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üé¥ Buat Kartu Ucapan</h3>
                <button onclick="hideModal('addCard')" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nama Penerima *</label>
                    <input type="text" id="cardRecipient" required>
                </div>
                <div class="form-group">
                    <label>No HP Penerima *</label>
                    <input type="tel" id="cardPhone" required>
                </div>
                <div class="form-group">
                    <label>Tema *</label>
                    <select id="cardTheme" required>
                        <option value="">Pilih Tema</option>
                        <option value="birthday">üéÇ Ulang Tahun</option>
                        <option value="anniversary">üíë Hari Jadi</option>
                        <option value="graduation">üéì Wisuda</option>
                        <option value="congrats">üéâ Selamat</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Pesan *</label>
                    <textarea id="cardMessage" rows="4" required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="hideModal('addCard')" style="background: #6c757d; color: white;">Batal</button>
                <button class="btn btn-info" onclick="saveCard()">Simpan Kartu</button>
            </div>
        </div>
    </div>

    <script>
        // ========== CONFIGURATION ==========
        let API_URL = localStorage.getItem('fior_api_url') || '';
        let currentPage = 'dashboard';
        
        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Admin Panel Loaded');
            
            // Load saved API URL
            if (API_URL) {
                document.getElementById('apiUrl').value = API_URL;
                checkApiStatus();
            }
            
            // Load dashboard
            showPage('dashboard');
        });
        
        // ========== PAGE NAVIGATION ==========
        function showPage(page) {
            currentPage = page;
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                cards: 'Kartu Ucapan',
                customers: 'Pelanggan',
                settings: 'Pengaturan'
            };
            
            const subtitles = {
                dashboard: 'Ringkasan sistem dan statistik',
                cards: 'Kelola kartu ucapan',
                customers: 'Kelola data pelanggan',
                settings: 'Pengaturan sistem'
            };
            
            document.getElementById('pageTitle').textContent = titles[page];
            document.getElementById('pageSubtitle').textContent = subtitles[page];
            
            // Load page content
            if (page === 'dashboard') {
                loadDashboard();
            } else if (page === 'cards') {
                loadCardsPage();
            } else if (page === 'customers') {
                loadCustomersPage();
            } else if (page === 'settings') {
                loadSettingsPage();
            }
        }
        
        // ========== DASHBOARD ==========
        async function loadDashboard() {
            const content = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-number" id="statCustomers">0</div>
                        <div class="stat-label">Total Pelanggan</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üé¥</div>
                        <div class="stat-number" id="statCards">0</div>
                        <div class="stat-label">Total Kartu</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-number" id="statToday">0</div>
                        <div class="stat-label">Kartu Hari Ini</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-number" id="statPending">0</div>
                        <div class="stat-label">Menunggu</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                    <div class="card">
                        <div class="card-header">
                            <h3>üé¥ Kartu Terbaru</h3>
                            <button class="btn btn-primary" onclick="showModal('addCard')">
                                + Buat Kartu
                            </button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Penerima</th>
                                        <th>Tema</th>
                                        <th>Status</th>
                                        <th>Tanggal</th>
                                    </tr>
                                </thead>
                                <tbody id="recentCards">
                                    <tr>
                                        <td colspan="4" style="text-align: center; padding: 20px;">
                                            <div class="loading"></div>
                                            <p style="margin-top: 10px;">Memuat data...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>üë• Pelanggan Terbaru</h3>
                            <button class="btn btn-success" onclick="showModal('addCustomer')">
                                + Tambah
                            </button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nama</th>
                                        <th>No HP</th>
                                        <th>Email</th>
                                    </tr>
                                </thead>
                                <tbody id="recentCustomers">
                                    <tr>
                                        <td colspan="3" style="text-align: center; padding: 20px;">
                                            <div class="loading"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <h3>‚ö° Aksi Cepat</h3>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showModal('addCard')">
                            üé¥ Buat Kartu Baru
                        </button>
                        <button class="btn btn-success" onclick="showModal('addCustomer')">
                            üë§ Tambah Pelanggan
                        </button>
                        <button class="btn btn-info" onclick="setupSheets()">
                            ‚öôÔ∏è Setup Sheets
                        </button>
                        <button class="btn" onclick="testApi()" style="background: #6c757d; color: white;">
                            üîå Test Koneksi
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = content;
            
            // Load sample data for now
            loadSampleData();
        }
        
        // ========== CARDS PAGE ==========
        function loadCardsPage() {
            const content = `
                <div class="card">
                    <div class="card-header">
                        <h3>üé¥ Daftar Kartu Ucapan</h3>
                        <div>
                            <button class="btn btn-primary" onclick="showModal('addCard')">
                                + Buat Kartu Baru
                            </button>
                            <button class="btn" onclick="refreshCards()" style="margin-left: 10px; background: #6c757d; color: white;">
                                üîÑ Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Penerima</th>
                                    <th>No HP</th>
                                    <th>Tema</th>
                                    <th>Pesan</th>
                                    <th>Status</th>
                                    <th>Tanggal</th>
                                </tr>
                            </thead>
                            <tbody id="cardsTable">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px;">
                                        <div class="loading"></div>
                                        <p style="margin-top: 10px;">Memuat data kartu...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = content;
            
            // Load cards data
            setTimeout(loadCardsData, 1000);
        }
        
        // ========== CUSTOMERS PAGE ==========
        function loadCustomersPage() {
            const content = `
                <div class="card">
                    <div class="card-header">
                        <h3>üë• Daftar Pelanggan</h3>
                        <div>
                            <button class="btn btn-success" onclick="showModal('addCustomer')">
                                + Tambah Pelanggan
                            </button>
                            <button class="btn" onclick="refreshCustomers()" style="margin-left: 10px; background: #6c757d; color: white;">
                                üîÑ Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama</th>
                                    <th>No HP</th>
                                    <th>Email</th>
                                    <th>Alamat</th>
                                    <th>Tanggal Daftar</th>
                                </tr>
                            </thead>
                            <tbody id="customersTable">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px;">
                                        <div class="loading"></div>
                                        <p style="margin-top: 10px;">Memuat data pelanggan...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = content;
            
            // Load customers data
            setTimeout(loadCustomersData, 1000);
        }
        
        // ========== SETTINGS PAGE ==========
        function loadSettingsPage() {
            const content = `
                <div class="card">
                    <div class="card-header">
                        <h3>‚öôÔ∏è Pengaturan Sistem</h3>
                    </div>
                    <div style="padding: 20px;">
                        <div class="form-group">
                            <label>URL API</label>
                            <input type="text" id="settingsApiUrl" value="${API_URL}" 
                                   style="margin-bottom: 10px;">
                            <button class="btn btn-primary" onclick="saveSettings()">
                                üíæ Simpan Pengaturan
                            </button>
                        </div>
                        
                        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                            <h4 style="margin-bottom: 15px;">üõ†Ô∏è Tools Sistem</h4>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-info" onclick="setupSheets()">
                                    ‚öôÔ∏è Setup Sheets
                                </button>
                                <button class="btn" onclick="testApi()" style="background: #6c757d; color: white;">
                                    üîå Test Koneksi
                                </button>
                                <button class="btn" onclick="clearCache()" style="background: #ffc107; color: black;">
                                    üóëÔ∏è Clear Cache
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = content;
        }
        
        // ========== SAMPLE DATA (for demo) ==========
        function loadSampleData() {
            // Sample stats
            document.getElementById('statCustomers').textContent = '24';
            document.getElementById('statCards').textContent = '156';
            document.getElementById('statToday').textContent = '12';
            document.getElementById('statPending').textContent = '3';
            
            // Sample recent cards
            const recentCards = document.getElementById('recentCards');
            const sampleCards = [
                { recipient: 'Budi Santoso', theme: 'birthday', status: 'Sent', date: '2024-01-20' },
                { recipient: 'Ani Wijaya', theme: 'anniversary', status: 'Pending', date: '2024-01-20' },
                { recipient: 'Citra Lestari', theme: 'graduation', status: 'Sent', date: '2024-01-19' },
                { recipient: 'Dian Pratama', theme: 'congrats', status: 'Draft', date: '2024-01-19' }
            ];
            
            recentCards.innerHTML = sampleCards.map(card => `
                <tr>
                    <td>${card.recipient}</td>
                    <td>${card.theme}</td>
                    <td><span class="badge ${getStatusClass(card.status)}">${card.status}</span></td>
                    <td>${card.date}</td>
                </tr>
            `).join('');
            
            // Sample recent customers
            const recentCustomers = document.getElementById('recentCustomers');
            const sampleCustomers = [
                { name: 'Budi Santoso', phone: '08123456789', email: 'budi@email.com' },
                { name: 'Ani Wijaya', phone: '08122334455', email: 'ani@email.com' },
                { name: 'Citra Lestari', phone: '08111222333', email: 'citra@email.com' }
            ];
            
            recentCustomers.innerHTML = sampleCustomers.map(customer => `
                <tr>
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.email}</td>
                </tr>
            `).join('');
        }
        
        function loadCardsData() {
            const cardsTable = document.getElementById('cardsTable');
            const sampleCards = [
                { no: 1, recipient: 'Budi Santoso', phone: '08123456789', theme: 'birthday', message: 'Selamat ulang tahun!', status: 'Sent', date: '2024-01-20' },
                { no: 2, recipient: 'Ani Wijaya', phone: '08122334455', theme: 'anniversary', message: 'Selamat hari jadi!', status: 'Pending', date: '2024-01-20' },
                { no: 3, recipient: 'Citra Lestari', phone: '08111222333', theme: 'graduation', message: 'Selamat wisuda!', status: 'Sent', date: '2024-01-19' },
                { no: 4, recipient: 'Dian Pratama', phone: '08199887766', theme: 'congrats', message: 'Selamat atas promosinya!', status: 'Draft', date: '2024-01-18' }
            ];
            
            cardsTable.innerHTML = sampleCards.map(card => `
                <tr>
                    <td>${card.no}</td>
                    <td>${card.recipient}</td>
                    <td>${card.phone}</td>
                    <td>${card.theme}</td>
                    <td>${card.message}</td>
                    <td><span class="badge ${getStatusClass(card.status)}">${card.status}</span></td>
                    <td>${card.date}</td>
                </tr>
            `).join('');
        }
        
        function loadCustomersData() {
            const customersTable = document.getElementById('customersTable');
            const sampleCustomers = [
                { no: 1, name: 'Budi Santoso', phone: '08123456789', email: 'budi@email.com', address: 'Jl. Merdeka No. 1', date: '2024-01-15' },
                { no: 2, name: 'Ani Wijaya', phone: '08122334455', email: 'ani@email.com', address: 'Jl. Sudirman No. 45', date: '2024-01-14' },
                { no: 3, name: 'Citra Lestari', phone: '08111222333', email: 'citra@email.com', address: 'Jl. Thamrin No. 12', date: '2024-01-13' },
                { no: 4, name: 'Dian Pratama', phone: '08199887766', email: 'dian@email.com', address: 'Jl. Gatot Subroto No. 88', date: '2024-01-12' }
            ];
            
            customersTable.innerHTML = sampleCustomers.map(customer => `
                <tr>
                    <td>${customer.no}</td>
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.email}</td>
                    <td>${customer.address}</td>
                    <td>${customer.date}</td>
                </tr>
            `).join('');
        }
        
        // ========== API FUNCTIONS ==========
        function checkApiStatus() {
            const statusEl = document.getElementById('apiStatus');
            const statusText = document.getElementById('statusText');
            
            if (!API_URL) {
                statusEl.className = 'api-status status-offline';
                statusText.textContent = 'URL belum diatur';
                return;
            }
            
            // Show loading
            statusEl.className = 'api-status';
            statusText.innerHTML = '<span class="loading"></span> Checking...';
            
            // Test API connection
            fetch(API_URL)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        statusEl.className = 'api-status status-online';
                        statusText.innerHTML = '‚úÖ API Connected';
                        showToast('success', 'API terhubung!', 'Koneksi ke Google Sheets berhasil.');
                    } else {
                        throw new Error(data.message || 'API error');
                    }
                })
                .catch(error => {
                    statusEl.className = 'api-status status-offline';
                    statusText.textContent = '‚ùå API Error';
                    showToast('error', 'Koneksi gagal', 'Tidak dapat menghubungi API.');
                    console.error('API Error:', error);
                });
        }
        
        function testApi() {
            if (!API_URL) {
                showToast('error', 'URL belum diatur', 'Silakan atur URL API terlebih dahulu.');
                return;
            }
            
            showToast('info', 'Menguji koneksi...');
            checkApiStatus();
        }
        
        async function setupSheets() {
            if (!API_URL) {
                showToast('error', 'URL belum diatur');
                return;
            }
            
            if (!confirm('Setup akan membuat sheet di Google Sheets. Lanjutkan?')) {
                return;
            }
            
            showToast('info', 'Menyiapkan sheets...');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'setup_sheets'
                    })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    showToast('success', 'Setup berhasil!', data.message);
                    
                    // Add sample data
                    const sampleResponse = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            type: 'add_sample'
                        })
                    });
                    
                    const sampleData = await sampleResponse.json();
                    
                    if (sampleData.status === 'success') {
                        showToast('success', 'Data contoh ditambahkan', sampleData.message);
                    }
                } else {
                    showToast('error', 'Setup gagal', data.message);
                }
            } catch (error) {
                showToast('error', 'Setup gagal', error.message);
            }
        }
        
        async function saveCustomer() {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            
            if (!name || !phone) {
                showToast('error', 'Data tidak lengkap', 'Nama dan No HP wajib diisi.');
                return;
            }
            
            if (!API_URL) {
                showToast('error', 'API belum dikonfigurasi');
                return;
            }
            
            showToast('info', 'Menyimpan pelanggan...');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'add_customer',
                        nama: name,
                        no_hp: phone,
                        email: document.getElementById('customerEmail').value,
                        alamat: document.getElementById('customerAddress').value
                    })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    showToast('success', 'Berhasil!', `Pelanggan "${name}" berhasil ditambahkan.`);
                    hideModal('addCustomer');
                    
                    // Clear form
                    document.getElementById('customerName').value = '';
                    document.getElementById('customerPhone').value = '';
                    document.getElementById('customerEmail').value = '';
                    document.getElementById('customerAddress').value = '';
                    
                    // Refresh page
                    if (currentPage === 'customers') {
                        loadCustomersPage();
                    } else if (currentPage === 'dashboard') {
                        loadSampleData();
                    }
                } else {
                    showToast('error', 'Gagal menyimpan', data.message);
                }
            } catch (error) {
                showToast('error', 'Gagal menyimpan', error.message);
            }
        }
        
        async function saveCard() {
            const recipient = document.getElementById('cardRecipient').value;
            const phone = document.getElementById('cardPhone').value;
            const theme = document.getElementById('cardTheme').value;
            const message = document.getElementById('cardMessage').value;
            
            if (!recipient || !phone || !theme || !message) {
                showToast('error', 'Data tidak lengkap', 'Semua field wajib diisi.');
                return;
            }
            
            if (!API_URL) {
                showToast('error', 'API belum dikonfigurasi');
                return;
            }
            
            showToast('info', 'Menyimpan kartu...');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'add_card',
                        nama_penerima: recipient,
                        no_hp: phone,
                        tema: theme,
                        pesan: message
                    })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    showToast('success', 'Berhasil!', `Kartu untuk "${recipient}" berhasil dibuat.`);
                    hideModal('addCard');
                    
                    // Clear form
                    document.getElementById('cardRecipient').value = '';
                    document.getElementById('cardPhone').value = '';
                    document.getElementById('cardTheme').value = '';
                    document.getElementById('cardMessage').value = '';
                    
                    // Refresh page
                    if (currentPage === 'cards') {
                        loadCardsPage();
                    } else if (currentPage === 'dashboard') {
                        loadSampleData();
                    }
                } else {
                    showToast('error', 'Gagal menyimpan', data.message);
                }
            } catch (error) {
                showToast('error', 'Gagal menyimpan', error.message);
            }
        }
        
        // ========== UI FUNCTIONS ==========
        function showModal(modalId) {
            document.getElementById(modalId + 'Modal').style.display = 'flex';
        }
        
        function hideModal(modalId) {
            document.getElementById(modalId + 'Modal').style.display = 'none';
        }
        
        function saveApiUrl() {
            const url = document.getElementById('apiUrl').value.trim();
            
            if (!url) {
                showToast('error', 'URL tidak boleh kosong');
                return;
            }
            
            API_URL = url;
            localStorage.setItem('fior_api_url', url);
            
            hideModal('config');
            showToast('success', 'URL disimpan!', 'Konfigurasi berhasil disimpan.');
            
            setTimeout(() => {
                checkApiStatus();
            }, 1000);
        }
        
        function saveSettings() {
            const url = document.getElementById('settingsApiUrl').value.trim();
            
            if (!url) {
                showToast('error', 'URL tidak boleh kosong');
                return;
            }
            
            API_URL = url;
            localStorage.setItem('fior_api_url', url);
            
            showToast('success', 'Pengaturan disimpan!', 'URL API berhasil diperbarui.');
            
            setTimeout(() => {
                checkApiStatus();
            }, 1000);
        }
        
        function refreshCards() {
            showToast('info', 'Memperbarui data...');
            setTimeout(loadCardsData, 1000);
        }
        
        function refreshCustomers() {
            showToast('info', 'Memperbarui data...');
            setTimeout(loadCustomersData, 1000);
        }
        
        function clearCache() {
            if (confirm('Hapus semua cache dan pengaturan lokal?')) {
                localStorage.removeItem('fior_api_url');
                API_URL = '';
                showToast('info', 'Cache dibersihkan', 'Halaman akan dimuat ulang...');
                setTimeout(() => location.reload(), 1000);
            }
        }
        
        function showToast(type, title, message = '') {
            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div style="font-size: 1.2rem;">
                    ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}
                </div>
                <div>
                    <strong>${title}</strong>
                    ${message ? '<div style="font-size: 0.9rem; margin-top: 5px;">' + message + '</div>' : ''}
                </div>
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            // Show toast
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }
        
        function getStatusClass(status) {
            if (status === 'Sent') return 'badge-success';
            if (status === 'Pending') return 'badge-warning';
            return 'badge-secondary';
        }
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        };
    </script>
</body>
</html>
