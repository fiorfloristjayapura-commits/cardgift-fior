<!DOCTYPE html>
<html>
<head>
    <title>FIOR Cards - Simple Admin</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .header { background: #4361ee; color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn { background: #4361ee; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: black; }
        input, textarea, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; }
        .status { padding: 5px 10px; border-radius: 20px; font-size: 12px; }
        .online { background: #d4edda; color: #155724; }
        .offline { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé¥ FIOR Card Generator</h1>
        <p>Simple Admin Panel</p>
        <span class="status offline" id="apiStatus">‚ùå API Offline</span>
    </div>
    
    <!-- API Config -->
    <div class="card">
        <h3>üì° API Configuration</h3>
        <input type="text" id="apiUrl" placeholder="https://script.google.com/macros/s/.../exec" style="margin-bottom: 10px;">
        <button class="btn" onclick="saveUrl()">Save URL</button>
        <button class="btn btn-success" onclick="testApi()">Test Connection</button>
        <button class="btn btn-warning" onclick="setupSheets()">Setup Sheets</button>
    </div>
    
    <!-- Quick Stats -->
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px 0;">
        <div class="card">
            <h3>üë• Customers</h3>
            <h1 id="statCustomers">0</h1>
        </div>
        <div class="card">
            <h3>üé¥ Cards</h3>
            <h1 id="statCards">0</h1>
        </div>
        <div class="card">
            <h3>üìÖ Today</h3>
            <h1 id="statToday">0</h1>
        </div>
        <div class="card">
            <h3>‚è≥ Pending</h3>
            <h1 id="statPending">0</h1>
        </div>
    </div>
    
    <!-- Forms -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div class="card">
            <h3>üë§ Add Customer</h3>
            <input type="text" id="custName" placeholder="Name">
            <input type="tel" id="custPhone" placeholder="Phone">
            <input type="email" id="custEmail" placeholder="Email (optional)">
            <button class="btn btn-success" onclick="addCustomer()" style="width: 100%; margin-top: 10px;">Add Customer</button>
        </div>
        
        <div class="card">
            <h3>üé¥ Create Card</h3>
            <input type="text" id="cardRecipient" placeholder="Recipient Name">
            <input type="tel" id="cardPhone" placeholder="Recipient Phone">
            <select id="cardTheme">
                <option value="birthday">Birthday</option>
                <option value="anniversary">Anniversary</option>
                <option value="graduation">Graduation</option>
            </select>
            <textarea id="cardMessage" placeholder="Message" rows="3"></textarea>
            <button class="btn" onclick="addCard()" style="width: 100%;">Create Card</button>
        </div>
    </div>
    
    <!-- Data Tables -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
        <div class="card">
            <h3>Recent Customers</h3>
            <div id="customersList">Loading...</div>
        </div>
        <div class="card">
            <h3>Recent Cards</h3>
            <div id="cardsList">Loading...</div>
        </div>
    </div>
    
    <script>
        // Configuration
        let API_URL = localStorage.getItem('fior_simple_api') || '';
        
        // Initialize
        if (API_URL) {
            document.getElementById('apiUrl').value = API_URL;
            testApi();
        }
        
        // Load sample data
        loadSampleData();
        
        function saveUrl() {
            const url = document.getElementById('apiUrl').value;
            if (url) {
                API_URL = url;
                localStorage.setItem('fior_simple_api', url);
                alert('URL saved!');
                testApi();
            }
        }
        
        function testApi() {
            if (!API_URL) {
                alert('Please enter API URL first');
                return;
            }
            
            document.getElementById('apiStatus').className = 'status offline';
            document.getElementById('apiStatus').textContent = 'Testing...';
            
            fetch(API_URL)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        document.getElementById('apiStatus').className = 'status online';
                        document.getElementById('apiStatus').textContent = '‚úÖ API Online';
                        alert('API Connection Successful!');
                    }
                })
                .catch(error => {
                    document.getElementById('apiStatus').className = 'status offline';
                    document.getElementById('apiStatus').textContent = '‚ùå API Error';
                    alert('API Connection Failed: ' + error.message);
                });
        }
        
        function setupSheets() {
            if (!API_URL) {
                alert('Please configure API URL first');
                return;
            }
            
            if (confirm('Setup will create Google Sheets. Continue?')) {
                fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'setup_sheets' })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message || 'Setup completed');
                })
                .catch(error => {
                    alert('Setup failed: ' + error.message);
                });
            }
        }
        
        function addCustomer() {
            const name = document.getElementById('custName').value;
            const phone = document.getElementById('custPhone').value;
            
            if (!name || !phone) {
                alert('Name and Phone are required');
                return;
            }
            
            if (!API_URL) {
                alert('API URL not configured');
                return;
            }
            
            const data = {
                type: 'add_customer',
                nama: name,
                no_hp: phone,
                email: document.getElementById('custEmail').value
            };
            
            fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.status === 'success') {
                    alert('Customer added successfully!');
                    document.getElementById('custName').value = '';
                    document.getElementById('custPhone').value = '';
                    document.getElementById('custEmail').value = '';
                    loadSampleData();
                } else {
                    alert('Error: ' + result.message);
                }
            })
            .catch(error => {
                alert('Error: ' + error.message);
            });
        }
        
        function addCard() {
            const recipient = document.getElementById('cardRecipient').value;
            const phone = document.getElementById('cardPhone').value;
            const theme = document.getElementById('cardTheme').value;
            const message = document.getElementById('cardMessage').value;
            
            if (!recipient || !phone || !theme || !message) {
                alert('All fields are required');
                return;
            }
            
            if (!API_URL) {
                alert('API URL not configured');
                return;
            }
            
            const data = {
                type: 'add_card',
                nama_penerima: recipient,
                no_hp: phone,
                tema: theme,
                pesan: message
            };
            
            fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.status === 'success') {
                    alert('Card created successfully!');
                    document.getElementById('cardRecipient').value = '';
                    document.getElementById('cardPhone').value = '';
                    document.getElementById('cardMessage').value = '';
                    loadSampleData();
                } else {
                    alert('Error: ' + result.message);
                }
            })
            .catch(error => {
                alert('Error: ' + error.message);
            });
        }
        
        function loadSampleData() {
            // Sample stats
            document.getElementById('statCustomers').textContent = '24';
            document.getElementById('statCards').textContent = '156';
            document.getElementById('statToday').textContent = '12';
            document.getElementById('statPending').textContent = '3';
            
            // Sample customers
            const customers = [
                { name: 'Budi Santoso', phone: '08123456789', email: 'budi@email.com' },
                { name: 'Ani Wijaya', phone: '08122334455', email: 'ani@email.com' },
                { name: 'Citra Lestari', phone: '08111222333', email: 'citra@email.com' }
            ];
            
            document.getElementById('customersList').innerHTML = `
                <table>
                    ${customers.map(c => `
                        <tr>
                            <td>${c.name}</td>
                            <td>${c.phone}</td>
                            <td>${c.email}</td>
                        </tr>
                    `).join('')}
                </table>
            `;
            
            // Sample cards
            const cards = [
                { recipient: 'Budi Santoso', theme: 'birthday', message: 'Happy Birthday!', status: 'Sent' },
                { recipient: 'Ani Wijaya', theme: 'anniversary', message: 'Happy Anniversary!', status: 'Pending' },
                { recipient: 'Citra Lestari', theme: 'graduation', message: 'Congratulations!', status: 'Sent' }
            ];
            
            document.getElementById('cardsList').innerHTML = `
                <table>
                    ${cards.map(c => `
                        <tr>
                            <td>${c.recipient}</td>
                            <td>${c.theme}</td>
                            <td>${c.message.substring(0, 20)}...</td>
                            <td>${c.status}</td>
                        </tr>
                    `).join('')}
                </table>
            `;
        }
    </script>
</body>
</html>
